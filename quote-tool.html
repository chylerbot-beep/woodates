<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Woodates Design &amp; Build ‚Äî Generate a Quote</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=DM+Serif+Display:ital@0;1&family=DM+Sans:wght@300;400;500;600&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx-js-style/1.2.0/xlsx.bundle.js"></script>
    
    
    <style>
    /* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
       WOODATES BRAND ‚Äî matches index/workflow/admin
       ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
    :root {
      --cream:        #F5F0E8;
      --dark:         #1A1A18;
      --warm-mid:     #6B5B4E;
      --accent:       #C4956A;
      --accent-light: #E8D5BF;
      --green-check:  #4A7C59;
      --border:       #D6CEC4;
      --shadow:       0 2px 12px rgba(26,26,24,0.08);
      --shadow-md:    0 4px 20px rgba(0,0,0,0.07);
    }

    *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }
    html, body { overflow-x: hidden; }

    body {
      font-family: 'DM Sans', sans-serif;
      background: var(--cream);
      color: var(--dark);
      line-height: 1.5;
    }

    /* ‚îÄ‚îÄ STICKY APP HEADER (same as workflow/admin) ‚îÄ‚îÄ */
    .app-header {
      background: var(--dark);
      color: var(--cream);
      padding: 20px 32px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 16px;
      position: sticky;
      top: 0;
      z-index: 200;
      box-shadow: 0 4px 24px rgba(0,0,0,0.25);
    }

    .app-header h1 {
      font-family: 'DM Serif Display', serif;
      font-size: 1.4rem;
      line-height: 1.1;
    }

    .app-header h1 span {
      display: block;
      font-family: 'DM Sans', sans-serif;
      font-size: 0.65rem;
      font-weight: 400;
      letter-spacing: 0.15em;
      text-transform: uppercase;
      color: var(--accent);
      margin-bottom: 3px;
    }

    .btn-home {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      padding: 8px 14px;
      border-radius: 6px;
      font-family: 'DM Sans', sans-serif;
      font-size: 0.8rem;
      font-weight: 500;
      cursor: pointer;
      text-decoration: none;
      background: rgba(255,255,255,0.08);
      color: #BDB5AD;
      border: 1px solid rgba(255,255,255,0.15);
      transition: all 0.2s;
      white-space: nowrap;
    }

    .btn-home:hover {
      background: rgba(255,255,255,0.16);
      color: var(--cream);
    }

    /* ‚îÄ‚îÄ LAYOUT ‚îÄ‚îÄ */
    .app-container {
      display: grid;
      grid-template-columns: 1fr 300px;
      min-height: calc(100vh - 73px);
    }

    @media (max-width: 992px) {
      .app-container { grid-template-columns: 1fr; }
    }

    /* ‚îÄ‚îÄ MAIN CONTENT ‚îÄ‚îÄ */
    .main-content {
      padding: 32px;
      max-width: 960px;
      width: 100%;
    }

    /* ‚îÄ‚îÄ STEP INDICATOR ‚îÄ‚îÄ */
    header { margin-bottom: 28px; }

    .logo { display: none; }

    .step-indicator {
      display: flex;
      gap: 24px;
      flex-wrap: wrap;
    }

    .step {
      display: flex;
      align-items: center;
      gap: 8px;
      color: #BDB5AD;
      font-size: 0.82rem;
      font-weight: 500;
    }

    .step.active { color: var(--accent); }
    .step.done   { color: var(--green-check); }

    .step-number {
      width: 22px; height: 22px;
      border-radius: 50%;
      border: 2px solid currentColor;
      display: flex; align-items: center; justify-content: center;
      font-size: 0.7rem;
      flex-shrink: 0;
    }

    /* ‚îÄ‚îÄ VIEWS ‚îÄ‚îÄ */
    .view { display: none; }
    .view.active {
      display: block;
      animation: fadeIn 0.25s ease;
    }
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(8px); }
      to   { opacity: 1; transform: translateY(0); }
    }

    /* ‚îÄ‚îÄ CARDS ‚îÄ‚îÄ */
    .card {
      background: white;
      padding: 28px;
      border-radius: 12px;
      box-shadow: var(--shadow);
      margin-bottom: 20px;
      border-left: 4px solid var(--accent);
    }

    .card h2 {
      font-family: 'DM Serif Display', serif;
      font-size: 1.1rem;
      margin-bottom: 20px;
    }

    /* ‚îÄ‚îÄ FORMS ‚îÄ‚îÄ */
    .form-group { margin-bottom: 20px; }

    label {
      display: block;
      font-size: 0.65rem;
      font-weight: 600;
      letter-spacing: 0.1em;
      text-transform: uppercase;
      color: var(--warm-mid);
      margin-bottom: 6px;
    }

    input[type="text"],
    input[type="tel"],
    input[type="number"],
    select {
      width: 100%;
      padding: 8px 0;
      border: none;
      border-bottom: 1.5px solid var(--border);
      border-radius: 0;
      font-family: 'DM Sans', sans-serif;
      font-size: 0.95rem;
      color: var(--dark);
      background: transparent;
      outline: none;
      transition: border-color 0.2s;
      -webkit-appearance: none;
      appearance: none;
    }

    input[type="text"]:focus,
    input[type="tel"]:focus,
    input[type="number"]:focus,
    select:focus { border-color: var(--accent); }

    input::placeholder { color: #BDB5AD; }

    select {
      background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='8' viewBox='0 0 12 8'%3E%3Cpath fill='%236B5B4E' d='M6 8L0 0h12z'/%3E%3C/svg%3E");
      background-repeat: no-repeat;
      background-position: right 4px center;
      padding-right: 24px;
      cursor: pointer;
    }

    /* ‚îÄ‚îÄ BUTTONS ‚îÄ‚îÄ */
    .btn {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 6px;
      padding: 10px 24px;
      background: var(--dark);
      color: var(--cream);
      border: none;
      border-radius: 6px;
      font-family: 'DM Sans', sans-serif;
      font-size: 0.85rem;
      font-weight: 600;
      cursor: pointer;
      transition: opacity 0.2s, transform 0.1s;
      letter-spacing: 0.02em;
      text-decoration: none;
      white-space: nowrap;
    }

    .btn:hover  { opacity: 0.85; }
    .btn:active { transform: scale(0.98); }

    .btn-primary {
      background: var(--accent);
      color: white;
    }

    .btn-secondary {
      background: transparent;
      border: 1.5px solid var(--border);
      color: var(--warm-mid);
    }

    .btn-secondary:hover {
      border-color: var(--accent);
      color: var(--accent);
    }

    .btn-danger {
      background: transparent;
      border: 1.5px solid #E0BEBE;
      color: #B85C5C;
    }

    .btn-danger:hover { background: #FDF0F0; }

    /* ‚îÄ‚îÄ TABS ‚îÄ‚îÄ */
    .tab-bar {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      margin-bottom: 24px;
    }

    .tab-btn {
      white-space: nowrap;
      padding: 7px 16px;
      background: white;
      border: 1.5px solid var(--border);
      color: var(--warm-mid);
      border-radius: 99px;
      cursor: pointer;
      font-family: 'DM Sans', sans-serif;
      font-size: 0.8rem;
      font-weight: 500;
      display: flex;
      align-items: center;
      gap: 6px;
      transition: all 0.18s;
    }

    .tab-btn:hover    { border-color: var(--accent); color: var(--accent); }
    .tab-btn.active   { background: var(--dark); color: var(--cream); border-color: var(--dark); }

    /* ‚îÄ‚îÄ ITEM CARDS ‚îÄ‚îÄ */
    .item-card {
      border: 1.5px solid var(--border);
      background: white;
      padding: 20px;
      border-radius: 8px;
      margin-bottom: 12px;
      display: grid;
      grid-template-columns: 1fr 200px;
      gap: 20px;
      transition: border-color 0.18s;
    }

    .item-card:hover    { border-color: var(--accent); }
    .item-card.selected { border-color: var(--accent); border-width: 2px; }

    .item-info h3 {
      font-family: 'DM Serif Display', serif;
      font-size: 1rem;
      margin-bottom: 4px;
    }

    .item-desc {
      font-size: 0.8rem;
      color: var(--warm-mid);
      margin-bottom: 10px;
      line-height: 1.5;
    }

    .item-price-info {
      font-weight: 600;
      color: var(--accent);
      font-size: 0.875rem;
    }

    .item-input-group {
      display: flex;
      flex-direction: column;
      gap: 6px;
      justify-content: center;
    }

    .input-with-unit { position: relative; }

    .input-with-unit input {
      padding-right: 40px;
      padding-left: 0;
    }

    .input-unit {
      position: absolute;
      right: 4px; top: 50%;
      transform: translateY(-50%);
      color: var(--warm-mid);
      font-size: 0.75rem;
      font-weight: 500;
    }

    .pfr-hint {
      font-size: 0.7rem;
      color: #BDB5AD;
      text-align: right;
      margin-top: 2px;
    }

    .item-subtotal {
      text-align: right;
      font-weight: 700;
      font-size: 1rem;
      color: var(--dark);
      margin-top: 6px;
    }

    /* ‚îÄ‚îÄ SIDEBAR ‚îÄ‚îÄ */
    .sidebar {
      background: white;
      padding: 28px 24px;
      position: sticky;
      top: 73px;
      height: calc(100vh - 73px);
      display: flex;
      flex-direction: column;
      border-left: 1px solid var(--border);
      overflow-y: auto;
    }

    .sidebar-title {
      font-size: 0.65rem;
      text-transform: uppercase;
      letter-spacing: 0.12em;
      color: var(--warm-mid);
      font-weight: 600;
      margin-bottom: 20px;
    }

    .summary-list {
      flex-grow: 1;
      overflow-y: auto;
      margin-bottom: 16px;
    }

    .summary-item {
      display: flex;
      justify-content: space-between;
      margin-bottom: 10px;
      font-size: 0.875rem;
    }

    .summary-item span:last-child { font-weight: 600; }

    .summary-divider {
      height: 1px;
      background: var(--border);
      margin: 14px 0;
    }

    .total-row {
      display: flex;
      justify-content: space-between;
      font-family: 'DM Serif Display', serif;
      font-size: 1.2rem;
    }

    .total-row span:last-child { color: var(--accent); }

    /* Mobile sidebar ‚Äî fixed bottom strip */
    @media (max-width: 992px) {
      .sidebar {
        position: fixed;
        bottom: 0; top: auto; left: 0; right: 0;
        height: auto;
        padding: 12px 20px;
        flex-direction: row;
        align-items: center;
        justify-content: space-between;
        gap: 12px;
        z-index: 100;
        border-left: none;
        border-top: 1px solid var(--border);
        box-shadow: 0 -4px 16px rgba(0,0,0,0.06);
      }
      .sidebar-content { display: none !important; }
      .sidebar-title   { display: none; }
      .summary-list    { display: none; }
      .summary-divider { display: none; }
      .mobile-total    { display: flex !important; }
    }

    .mobile-total {
      display: none;
      align-items: center;
      gap: 8px;
      font-family: 'DM Serif Display', serif;
      font-size: 1.1rem;
    }

    .mobile-total span:last-child { color: var(--accent); font-weight: 700; }

    .mobile-gst-toggle {
      display: none;
      align-items: center;
      gap: 6px;
      font-size: 0.75rem;
      color: var(--warm-mid);
    }

    @media (max-width: 992px) {
      .mobile-gst-toggle { display: flex; }
    }

    /* ‚îÄ‚îÄ QUOTE PREVIEW ‚îÄ‚îÄ */
    .quote-preview {
      background: white;
      color: var(--dark);
      padding: 40px;
      border-radius: 12px;
      max-width: 800px;
      margin: 0 auto;
      box-shadow: var(--shadow-md);
    }

    .quote-header {
      display: flex;
      justify-content: space-between;
      margin-bottom: 32px;
      border-bottom: 2px solid var(--dark);
      padding-bottom: 24px;
    }

    .company-info h1 {
      font-family: 'DM Serif Display', serif;
      font-size: 1.4rem;
    }

    .client-info h2 {
      font-family: 'DM Serif Display', serif;
      font-size: 1.1rem;
      margin-bottom: 12px;
    }

    .quote-table {
      width: 100%;
      border-collapse: collapse;
      margin-bottom: 20px;
    }

    .quote-table th {
      text-align: left;
      padding: 10px 12px;
      border-bottom: 2px solid var(--border);
      font-size: 0.72rem;
      text-transform: uppercase;
      letter-spacing: 0.06em;
      color: var(--warm-mid);
    }

    .quote-table td {
      padding: 10px 12px;
      border-bottom: 1px solid var(--border);
      vertical-align: top;
      font-size: 0.88rem;
    }

    .section-header {
      background: var(--cream);
      font-weight: 700;
      text-transform: uppercase;
      font-size: 0.72rem;
      letter-spacing: 0.06em;
      color: var(--warm-mid);
    }

    .grand-total-box {
      background: var(--cream);
      border-left: 4px solid var(--accent);
      padding: 16px 20px;
      text-align: right;
      font-family: 'DM Serif Display', serif;
      font-size: 1.4rem;
      color: var(--dark);
      margin-bottom: 32px;
      border-radius: 0 8px 8px 0;
    }

    .terms-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 32px;
      font-size: 0.75rem;
      color: var(--warm-mid);
    }

    .signature-block {
      margin-top: 40px;
      padding-top: 20px;
      border-top: 1px solid var(--border);
    }

    /* ‚îÄ‚îÄ UTILITIES ‚îÄ‚îÄ */
    .flex            { display: flex; }
    .justify-between { justify-content: space-between; }
    .mt-4            { margin-top: 16px; }
    .text-center     { text-align: center; }

    /* ‚îÄ‚îÄ MOBILE ‚îÄ‚îÄ */
    @media (max-width: 992px) {
      .app-header  { padding: 14px 16px; }
      .app-header h1 { font-size: 1.1rem; }
    }

    @media (max-width: 600px) {
      .main-content   { padding: 16px; padding-bottom: 90px; }
      .card           { padding: 16px; }
      .step-indicator { gap: 12px; }
      .step           { font-size: 0.75rem; }
      .btn            { width: 100%; padding: 12px; }
      .flex.justify-between { flex-direction: column; gap: 10px; }
      .tab-btn        { padding: 6px 12px; font-size: 0.75rem; }
      .item-card      { grid-template-columns: 1fr; padding: 14px; gap: 10px; }
      .terms-grid     { grid-template-columns: 1fr; gap: 16px; }
      .quote-preview  { padding: 20px; }
      .quote-header   { flex-direction: column; gap: 16px; }
      .phone-email-row { flex-direction: column !important; }
    }

    @media (max-width: 400px) {
      .app-header h1 { font-size: 1rem; }
      .main-content { padding: 12px; padding-bottom: 90px; }
      .card { padding: 14px; }
      .step { font-size: 0.7rem; }
    }

    /* ‚îÄ‚îÄ PRINT ‚îÄ‚îÄ */
    @media print {
      body { background: white !important; color: #000 !important; }
      .app-header, .sidebar, .tab-bar, .step-indicator,
      .pfr-hint, .btn:not(.print-only) { display: none !important; }
      .main-content   { padding: 0; max-width: none; width: 100%; margin: 0; }
      .app-container  { display: block; }
      .quote-preview  { width: 100%; padding: 0; box-shadow: none; border: none; }
      @page { margin: 1.5cm; }
    }
  </style>
</head>

<body>
  <!-- Auth checking overlay -->
  <div id="auth-checking" style="position:fixed;inset:0;background:#F9F6F1;display:flex;align-items:center;justify-content:center;z-index:9999;font-family:'DM Sans',sans-serif;font-size:1rem;color:#888">Checking access‚Ä¶</div>
  <div id="access-denied" style="position:fixed;inset:0;background:#F9F6F1;display:none;align-items:center;justify-content:center;z-index:9999;flex-direction:column;gap:16px;font-family:'DM Sans',sans-serif">
    <div style="font-size:1.1rem;font-weight:600;color:#333">Access denied</div>
    <a href="index.html" style="color:#B8975A;font-size:0.9rem">‚Üê Back to login</a>
  </div>

  

    <header class="app-header no-print">
      <div>
        <h1>
          <span>Woodates Design &amp; Build</span>
          Generate a Quote
        </h1>
      </div>
      <a href="index.html" class="btn-home">‚Üê Home</a>
    </header>

    <div class="app-container">
        <main class="main-content">
            <header>
                <div class="logo">WOODATES DESIGN &amp; BUILD</div>
                <div class="step-indicator">
                    <div class="step active" id="step-dot-1">
                        <span class="step-number">1</span> Client Details
                    </div>
                    <div class="step" id="step-dot-2">
                        <span class="step-number">2</span> Build Quote
                    </div>
                    <div class="step" id="step-dot-3">
                        <span class="step-number">3</span> Export
                    </div>
                </div>
            </header>

            <!-- STEP 1: CLIENT DETAILS -->
            <div id="step-1" class="view active">
                <div class="card">
                    <form id="client-form">
                        <div class="form-group">
                            <label>Client Name</label>
                            <input type="text" id="clientName" placeholder="e.g. John Tan" required>
                        </div>
                        <div class="form-group">
                            <label>Project Address</label>
                            <input type="text" id="projectAddress" placeholder="e.g. Tampines Green Opal" required>
                        </div>
                        <div class="form-group">
                            <label>Flat Type</label>
                            <select id="flatType">
                                <option>2-Room HDB</option>
                                <option>3-Room HDB</option>
                                <option selected>4-Room HDB</option>
                                <option>5-Room HDB</option>
                                <option>Executive Condo</option>
                                <option>Condominium</option>
                                <option>Landed Property</option>
                            </select>
                        </div>
                        <div class="text-center mt-4">
                            <button type="submit" class="btn">Next: Choose Items &rarr;</button>
                        </div>
                    </form>
                </div>
            </div>

            <!-- STEP 2: QUOTE BUILDER -->
            <div id="step-2" class="view">
                <div class="tab-bar" id="category-tabs">
                    <!-- Dynamic Tabs -->
                </div>

                <div id="item-list">
                    <!-- Dynamic Items -->
                </div>

                <div class="flex justify-between mt-4">
                    <button class="btn btn-secondary" data-action="goToStep" data-step="1">&larr; Back</button>
                    <button class="btn" data-action="goToStep" data-step="3">Preview Quote &rarr;</button>
                </div>
            </div>

            <!-- STEP 3: PREVIEW & EXPORT -->
            <div id="step-3" class="view">
                <div class="quote-preview" id="printable-quote">
                    <!-- Dynamic Quote Content -->
                </div>

                <div class="text-center mt-4 no-print">
                    <button class="btn btn-secondary" data-action="goToStep" data-step="2" style="margin-right:1rem;">&larr; Edit
                        Items</button>
                    <div
                        style="display:inline-flex; gap:0.75rem; flex-wrap:wrap; justify-content:center; margin-top:0; vertical-align:middle;">
                        <button class="btn" data-action="printPage"
                            style="display:inline-flex;align-items:center;gap:0.5rem;">
                            üñ®Ô∏è Download PDF / Print
                        </button>
                        <button class="btn btn-secondary" data-action="downloadExcel"
                            style="display:inline-flex;align-items:center;gap:0.5rem;">
                            üìä Download Excel
                        </button>
                        <button class="btn" data-action="saveQuoteToSupabase"
                            style="display:inline-flex;align-items:center;gap:0.5rem;background:#4A7C59;border-color:#4A7C59;">
                            üíæ Save to Portal
                        </button>
                    </div>
                    <div style="margin-top: 1.5rem;">
                        <button class="btn btn-danger" style="padding: 0.5rem 1rem; font-size: 0.75rem;" data-action="resetQuote">Reset Entire Quote</button>
                    </div>
                </div>
            </div>
        </main>

        <!-- SIDEBAR SUMMARY -->
        <aside class="sidebar">
            <div class="sidebar-title">Quote Summary</div>
            <div class="sidebar-content" style="display: block; flex: 1; display: flex; flex-direction: column;">
                <div class="summary-list" id="sidebar-summary-list">
                    <!-- Summary items -->
                </div>
                <div class="summary-divider"></div>
                <div class="summary-item">
                    <span>Subtotal</span>
                    <span id="sidebar-subtotal">$0.00</span>
                </div>
                <div class="summary-item" style="align-items: center;">
                    <span style="display:flex; align-items:center; gap:0.5rem;">
                        GST (9%)
                        <label
                            style="position:relative; display:inline-block; width:36px; height:20px; cursor:pointer;">
                            <input type="checkbox" id="gst-toggle" checked onchange="toggleGST(this.checked)"
                                style="opacity:0; width:0; height:0; position:absolute;">
                            <span id="gst-toggle-track" style="
                                position:absolute; top:0; left:0; right:0; bottom:0;
                                background:var(--accent); border-radius:20px; transition:0.2s;
                            "></span>
                            <span id="gst-toggle-thumb" style="
                                position:absolute; top:2px; left:2px;
                                width:16px; height:16px; border-radius:50%;
                                background:#fff; transition:0.2s;
                                transform: translateX(16px);
                            "></span>
                        </label>
                    </span>
                    <span id="sidebar-gst">$0.00</span>
                </div>
                <div class="total-row">
                    <span>Total</span>
                    <span id="sidebar-total">$0.00</span>
                </div>
            </div>
            <div class="mobile-total" id="mobile-total-display">
                <div>
                    <div
                        style="font-size:0.65rem; text-transform:uppercase; letter-spacing:0.08em; color:var(--warm-mid); margin-bottom:2px;">
                        Total</div>
                    <span id="mobile-total-amount">$0.00</span>
                </div>
                <div class="mobile-gst-toggle">
                    <span>GST</span>
                    <label style="position:relative; display:inline-block; width:32px; height:18px; cursor:pointer;">
                        <input type="checkbox" id="gst-toggle-mobile" checked onchange="toggleGST(this.checked)"
                            style="opacity:0; width:0; height:0; position:absolute;">
                        <span id="gst-track-mobile"
                            style="position:absolute;top:0;left:0;right:0;bottom:0;background:var(--accent);border-radius:18px;transition:0.2s;"></span>
                        <span id="gst-thumb-mobile"
                            style="position:absolute;top:2px;left:2px;width:14px;height:14px;border-radius:50%;background:#fff;transition:0.2s;transform:translateX(14px);"></span>
                    </label>
                </div>
            </div>
        </aside>
    </div>

    

  <script src="quote-tool.js"></script>
</body>

</html>