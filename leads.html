<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Leads | Woodates</title>
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<link href="https://fonts.googleapis.com/css2?family=DM+Sans:wght@300;400;500;600;700&family=DM+Serif+Display:ital@0;1&display=swap" rel="stylesheet">
<style>
  :root {
    --cream: #F5F0E8;
    --cream-dark: #EDE8DF;
    --white: #FFFFFF;
    --dark: #1A1A18;
    --dark-mid: #3D3B36;
    --muted: #8A8278;
    --border: #D6CEC4;
    --border-light: #E8E2D9;
    --shadow: 0 4px 20px rgba(0,0,0,0.06);
    --shadow-sm: 0 2px 8px rgba(0,0,0,0.04);

    --active: #C4956A;
    --active-bg: #FAF3EC;
    --active-border: #E8C9A8;

    --signed: #5A8A6A;
    --signed-bg: #EEF6F0;
    --signed-border: #B2D4BB;

    --lapsed: #B05A5A;
    --lapsed-bg: #F8EDED;
    --lapsed-border: #DCAFAF;

    --keyco: #7A6A3A;
    --keyco-bg: #F7F2E4;
    --keyco-border: #D4C48A;
  }

  * { box-sizing: border-box; margin: 0; padding: 0; }
  body { background: var(--cream); color: var(--dark); font-family: 'DM Sans', sans-serif; min-height: 100vh; display: none; }

  /* ‚îÄ‚îÄ AUTH GUARD OVERLAY ‚îÄ‚îÄ */
  #auth-checking {
    display: flex;
    position: fixed;
    inset: 0;
    background: var(--cream);
    z-index: 9999;
    align-items: center;
    justify-content: center;
    flex-direction: column;
    gap: 14px;
    font-family: 'DM Sans', sans-serif;
  }
  #auth-checking p { color: var(--muted); font-size: 0.9rem; }
  .auth-spinner {
    width: 36px; height: 36px;
    border: 3px solid var(--border);
    border-top-color: var(--active);
    border-radius: 50%;
    animation: spin 0.8s linear infinite;
  }
  @keyframes spin { to { transform: rotate(360deg); } }
  #access-denied {
    display: none;
    position: fixed;
    inset: 0;
    background: var(--cream);
    z-index: 9999;
    align-items: center;
    justify-content: center;
    flex-direction: column;
    gap: 16px;
    font-family: 'DM Sans', sans-serif;
    text-align: center;
    padding: 24px;
  }
  #access-denied h2 { font-family: 'DM Serif Display', serif; font-size: 2rem; color: var(--dark); }
  #access-denied p { color: var(--muted); font-size: 0.9rem; max-width: 360px; }
  #access-denied a {
    margin-top: 8px;
    display: inline-block;
    padding: 10px 24px;
    background: var(--active);
    color: white;
    border-radius: 8px;
    text-decoration: none;
    font-weight: 700;
    font-size: 0.9rem;
    transition: background 0.2s;
  }
  #access-denied a:hover { background: var(--dark); }

  /* ‚îÄ‚îÄ HEADER ‚îÄ‚îÄ */
  header {
    background: var(--white);
    border-bottom: 1px solid var(--border);
    position: sticky; top: 0; z-index: 200;
    box-shadow: var(--shadow-sm);
  }
  .header-top {
    padding: 20px 40px 0;
    display: flex;
    align-items: flex-end;
    gap: 32px;
  }
  .brand p {
    font-size: 0.7rem;
    text-transform: uppercase;
    letter-spacing: 0.18em;
    color: var(--active);
    font-weight: 600;
    margin-bottom: 2px;
  }
  .brand h1 {
    font-family: 'DM Serif Display', serif;
    font-size: 1.7rem;
    color: var(--dark);
    line-height: 1;
  }

  /* ‚îÄ‚îÄ MAIN NAV (just Chyler Leads) ‚îÄ‚îÄ */
  .main-nav {
    display: flex;
    gap: 0;
    flex: 1;
    padding-bottom: 0;
  }
  .main-nav-tab {
    padding: 14px 22px;
    font-size: 0.82rem;
    font-weight: 600;
    color: var(--dark);
    letter-spacing: 0.03em;
    border-bottom: 2px solid var(--active);
    white-space: nowrap;
  }

  /* ‚îÄ‚îÄ SUB TABS ‚îÄ‚îÄ */
  .sub-nav {
    display: flex;
    gap: 0;
    padding: 0 40px;
    background: var(--white);
    border-top: 1px solid var(--border-light);
  }
  .sub-tab {
    padding: 10px 20px;
    font-size: 0.78rem;
    font-weight: 600;
    color: var(--muted);
    cursor: pointer;
    border-bottom: 2px solid transparent;
    letter-spacing: 0.04em;
    text-transform: uppercase;
    transition: all 0.2s;
    white-space: nowrap;
  }
  .sub-tab:hover { color: var(--dark); }
  .sub-tab.active { color: var(--active); border-bottom-color: var(--active); }

  .header-actions {
    margin-left: auto;
    display: flex;
    align-items: center;
    gap: 10px;
    padding-bottom: 14px;
  }
  .btn-outline {
    border: 1px solid var(--border);
    padding: 7px 16px;
    border-radius: 6px;
    font-family: 'DM Sans', sans-serif;
    font-size: 0.8rem;
    font-weight: 600;
    cursor: pointer;
    text-decoration: none;
    color: var(--dark);
    background: transparent;
    transition: all 0.2s;
  }
  .btn-outline:hover { background: var(--dark); color: white; border-color: var(--dark); }

  /* ‚îÄ‚îÄ PAGES ‚îÄ‚îÄ */
  .page { display: none; padding: 36px 40px; max-width: 1600px; margin: 0 auto; }
  .page.active { display: block; }

  /* ‚îÄ‚îÄ PAGE HEADER ‚îÄ‚îÄ */
  .page-header { margin-bottom: 28px; }
  .page-title { font-family: 'DM Serif Display', serif; font-size: 2rem; color: var(--dark); }
  .page-subtitle { color: var(--muted); font-size: 0.82rem; margin-top: 4px; letter-spacing: 0.02em; }

  /* ‚îÄ‚îÄ STAT PILLS ‚îÄ‚îÄ */
  .stat-row { display: flex; gap: 10px; flex-wrap: wrap; margin-bottom: 28px; }
  .stat-pill {
    padding: 10px 18px;
    border-radius: 8px;
    font-size: 0.8rem;
    font-weight: 600;
    border: 1px solid;
    display: flex;
    align-items: center;
    gap: 10px;
  }
  .stat-pill .count {
    font-size: 1.3rem;
    font-family: 'DM Serif Display', serif;
    font-weight: 400;
    line-height: 1;
  }
  .stat-pill.s-active { background: var(--active-bg); border-color: var(--active-border); color: var(--active); }
  .stat-pill.s-signed { background: var(--signed-bg); border-color: var(--signed-border); color: var(--signed); }
  .stat-pill.s-lapsed { background: var(--lapsed-bg); border-color: var(--lapsed-border); color: var(--lapsed); }
  .stat-pill.s-keyco  { background: var(--keyco-bg);  border-color: var(--keyco-border);  color: var(--keyco); }
  .stat-pill.s-total  { background: var(--cream-dark); border-color: var(--border); color: var(--muted); }

  /* ‚îÄ‚îÄ FILTERS ‚îÄ‚îÄ */
  .filters { display: flex; gap: 10px; margin-bottom: 24px; flex-wrap: wrap; align-items: center; }
  .search-box, .filter-select {
    background: var(--white);
    border: 1px solid var(--border);
    border-radius: 8px;
    padding: 9px 14px;
    color: var(--dark);
    font-family: 'DM Sans', sans-serif;
    font-size: 0.85rem;
    outline: none;
    transition: border-color 0.2s;
  }
  .search-box { flex: 1; min-width: 200px; }
  .search-box::placeholder { color: var(--muted); }
  .search-box:focus, .filter-select:focus { border-color: var(--active); }
  .filter-select { cursor: pointer; }

  /* ‚îÄ‚îÄ SECTION HEADERS ‚îÄ‚îÄ */
  .section-header {
    display: flex;
    align-items: center;
    justify-content: space-between;
    margin: 32px 0 14px;
    padding-bottom: 12px;
    border-bottom: 1px solid var(--border-light);
  }
  .section-label { display: flex; align-items: center; gap: 10px; }
  .section-dot { width: 8px; height: 8px; border-radius: 50%; flex-shrink: 0; }
  .section-title {
    font-size: 0.72rem;
    font-weight: 700;
    letter-spacing: 0.12em;
    text-transform: uppercase;
  }
  .section-count {
    font-size: 0.72rem;
    background: var(--cream-dark);
    border: 1px solid var(--border);
    color: var(--muted);
    border-radius: 20px;
    padding: 2px 10px;
    font-weight: 600;
  }
  .toggle-btn {
    font-size: 0.75rem;
    color: var(--muted);
    background: var(--white);
    border: 1px solid var(--border);
    border-radius: 6px;
    padding: 5px 14px;
    cursor: pointer;
    font-family: 'DM Sans', sans-serif;
    font-weight: 600;
    transition: all 0.2s;
  }
  .toggle-btn:hover { color: var(--dark); border-color: var(--dark); }

  /* ‚îÄ‚îÄ KANBAN ‚îÄ‚îÄ */
  .pipeline-wrap { display: flex; gap: 14px; overflow-x: auto; padding-bottom: 10px; }
  .stage-col { min-width: 210px; max-width: 230px; flex-shrink: 0; }
  .stage-col-header {
    font-size: 0.68rem;
    font-weight: 700;
    letter-spacing: 0.1em;
    text-transform: uppercase;
    color: var(--muted);
    margin-bottom: 10px;
    padding: 8px 12px;
    background: var(--cream-dark);
    border-radius: 8px;
    text-align: center;
    border: 1px solid var(--border-light);
  }
  .stage-col-header .stage-num {
    color: var(--active);
    font-size: 1.3rem;
    font-family: 'DM Serif Display', serif;
    font-weight: 400;
    display: block;
    margin-bottom: 2px;
  }

  /* ‚îÄ‚îÄ CARDS ‚îÄ‚îÄ */
  .card {
    background: var(--white);
    border: 1px solid var(--border);
    border-radius: 10px;
    padding: 14px 16px;
    margin-bottom: 10px;
    transition: border-color 0.2s, box-shadow 0.2s, transform 0.1s;
  }
  .card:hover { border-color: var(--active-border); box-shadow: var(--shadow); transform: translateY(-1px); }

  .card.active-card  { border-left: 3px solid var(--active); }
  .card.signed-card  { border-left: 3px solid var(--signed); background: var(--signed-bg); }
  .card.lapsed-card  { border-left: 3px solid var(--lapsed); opacity: 0.8; }
  .card.keyco-card   { border-left: 3px solid var(--keyco); background: var(--keyco-bg); }

  .card-name { font-size: 0.9rem; font-weight: 700; color: var(--dark); margin-bottom: 8px; }
  .card-meta { display: flex; flex-wrap: wrap; gap: 5px; margin-bottom: 8px; }

  .tag {
    font-size: 0.68rem;
    padding: 3px 9px;
    border-radius: 20px;
    font-weight: 600;
    background: var(--cream-dark);
    color: var(--muted);
    border: 1px solid var(--border-light);
  }
  .tag.type-tag { background: var(--active-bg); color: var(--active); border-color: var(--active-border); }
  .tag.pm-tag   { background: #F0EDF8; color: #7A5FA0; border-color: #D8CEED; }
  .tag.stage-tag { background: #EBF3FB; color: #3A6EA8; border-color: #B8D4EE; font-size: 0.68rem; }

  .card-phone { font-size: 0.75rem; color: var(--muted); }
  .card-comment {
    font-size: 0.72rem;
    color: var(--muted);
    margin-top: 8px;
    font-style: italic;
    border-top: 1px solid var(--border-light);
    padding-top: 8px;
    line-height: 1.5;
  }
  .card-date { font-size: 0.68rem; color: #B0A89A; margin-top: 5px; }

  /* ‚îÄ‚îÄ PROGRESS BAR ‚îÄ‚îÄ */
  .progress-bar { height: 3px; background: var(--border-light); border-radius: 2px; margin-top: 10px; overflow: hidden; }
  .progress-fill { height: 100%; background: linear-gradient(90deg, var(--active-border), var(--active)); border-radius: 2px; transition: width 0.4s; }

  /* ‚îÄ‚îÄ GRID ‚îÄ‚îÄ */
  .cards-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(230px, 1fr)); gap: 10px; }

  /* ‚îÄ‚îÄ COLLAPSIBLE ‚îÄ‚îÄ */
  .collapsible-content { overflow: hidden; transition: max-height 0.4s ease; }
  .collapsible-content.collapsed { max-height: 0 !important; }

  /* ‚îÄ‚îÄ TABLE ‚îÄ‚îÄ */
  .table-wrap {
    background: var(--white);
    border-radius: 12px;
    overflow: auto;
    box-shadow: var(--shadow);
    border: 1px solid var(--border);
    max-height: calc(100vh - 300px);
  }
  .w-table { width: 100%; border-collapse: collapse; font-size: 0.82rem; text-align: left; }
  .w-table th {
    background: #F9F7F4;
    padding: 12px 14px;
    font-size: 0.65rem;
    text-transform: uppercase;
    letter-spacing: 0.08em;
    color: #6B5B4E;
    border-bottom: 1px solid var(--border);
    white-space: nowrap;
    position: sticky;
    top: 0;
    z-index: 10;
  }
  .w-table td {
    padding: 11px 14px;
    border-bottom: 1px solid var(--border-light);
    vertical-align: middle;
    white-space: nowrap;
  }
  .w-table tr:last-child td { border-bottom: none; }
  .w-table tr:hover td { background: #FAF8F5; }

  /* Editable table cells */
  .w-table td[contenteditable="true"] {
    outline: none;
    cursor: text;
  }
  .w-table td[contenteditable="true"]:focus {
    background: #FFFBF5;
    box-shadow: inset 0 0 0 2px var(--active-border);
    border-radius: 4px;
  }
  .edit-mode .w-table td[contenteditable="true"] {
    background: rgba(196,149,106,0.04);
  }

  /* Edit mode banner */
  .edit-banner {
    display: none;
    align-items: center;
    gap: 10px;
    padding: 10px 16px;
    background: var(--active-bg);
    border: 1px solid var(--active-border);
    border-radius: 8px;
    margin-bottom: 16px;
    font-size: 0.8rem;
    color: var(--active);
    font-weight: 600;
  }
  .edit-banner.visible { display: flex; }
  .edit-banner svg { flex-shrink: 0; }

  /* Edit toggle button styling */
  .btn-edit-toggle {
    display: flex;
    align-items: center;
    gap: 7px;
    border: 1px solid var(--border);
    padding: 7px 16px;
    border-radius: 6px;
    font-family: 'DM Sans', sans-serif;
    font-size: 0.8rem;
    font-weight: 600;
    cursor: pointer;
    color: var(--dark);
    background: var(--white);
    transition: all 0.2s;
  }
  .btn-edit-toggle.active {
    background: var(--active);
    border-color: var(--active);
    color: white;
  }
  .btn-edit-toggle:hover:not(.active) { background: var(--cream-dark); }

  /* Download button */
  .btn-download {
    display: flex;
    align-items: center;
    gap: 7px;
    border: 1px solid var(--signed-border);
    padding: 7px 16px;
    border-radius: 6px;
    font-family: 'DM Sans', sans-serif;
    font-size: 0.8rem;
    font-weight: 600;
    cursor: pointer;
    color: var(--signed);
    background: var(--signed-bg);
    transition: all 0.2s;
  }
  .btn-download:hover { background: var(--signed); color: white; border-color: var(--signed); }

  /* ‚îÄ‚îÄ STATUS BADGES ‚îÄ‚îÄ */
  .status-badge {
    display: inline-block;
    font-size: 0.65rem;
    padding: 3px 10px;
    border-radius: 20px;
    font-weight: 700;
    letter-spacing: 0.05em;
    border: 1px solid;
    white-space: nowrap;
  }
  .status-badge.ACTIVE { background: var(--active-bg); color: var(--active); border-color: var(--active-border); }
  .status-badge.SIGNED { background: var(--signed-bg); color: var(--signed); border-color: var(--signed-border); }
  .status-badge.LAPSED { background: var(--lapsed-bg); color: var(--lapsed); border-color: var(--lapsed-border); }
  .status-badge.LONG   { background: var(--keyco-bg);  color: var(--keyco);  border-color: var(--keyco-border); }

  .check { color: var(--signed); font-weight: 700; }
  .cross { color: var(--lapsed); }

  /* ‚îÄ‚îÄ Conditional formatting for YES/NO/PENDING ‚îÄ‚îÄ */
  .cell-yes { color: var(--signed); font-weight: 700; }
  .cell-no { color: var(--lapsed); }
  .cell-pending { color: var(--keyco); font-style: italic; font-size: 0.75rem; }
  .cell-scheduled { color: #5A7AAA; font-weight: 600; font-size: 0.75rem; }

  /* ‚îÄ‚îÄ Master list section headers ‚îÄ‚îÄ */
  .master-section-header {
    padding: 8px 14px;
    font-size: 0.65rem;
    font-weight: 700;
    text-transform: uppercase;
    letter-spacing: 0.1em;
    border-bottom: 1px solid var(--border-light);
  }
  .master-section-header.active-header { background: var(--active-bg); color: var(--active); }
  .master-section-header.signed-header { background: var(--signed-bg); color: var(--signed); }
  .master-section-header.lapsed-header { background: var(--lapsed-bg); color: var(--lapsed); }
  .master-section-header.keyco-header  { background: var(--keyco-bg);  color: var(--keyco); }

  /* ‚îÄ‚îÄ PILL COUNT (number shown inside filter pill) ‚îÄ‚îÄ */
  .pill-count {
    font-family: 'DM Serif Display', serif;
    font-size: 1.05rem;
    font-weight: 400;
    line-height: 1;
    margin-right: 7px;
    display: inline-block;
    vertical-align: middle;
  }
  .status-filter-pill .pill-count { opacity: 0.85; }
  .status-filter-pill.selected .pill-count,
  .status-filter-pill:hover .pill-count { opacity: 1; }

  /* ‚îÄ‚îÄ PIPELINE STATUS FILTER PILLS ‚îÄ‚îÄ */
  .status-filter-row {
    display: flex;
    gap: 8px;
    flex-wrap: wrap;
    margin-bottom: 20px;
  }
  .status-filter-pill {
    padding: 7px 16px;
    border-radius: 20px;
    font-size: 0.75rem;
    font-weight: 700;
    border: 1.5px solid;
    cursor: pointer;
    transition: all 0.2s;
    letter-spacing: 0.04em;
    text-transform: uppercase;
  }
  .status-filter-pill.sf-all { background: var(--cream-dark); border-color: var(--border); color: var(--muted); }
  .status-filter-pill.sf-all.selected,
  .status-filter-pill.sf-all:hover { background: var(--dark); border-color: var(--dark); color: white; }
  .status-filter-pill.sf-active { background: var(--active-bg); border-color: var(--active-border); color: var(--active); }
  .status-filter-pill.sf-active.selected,
  .status-filter-pill.sf-active:hover { background: var(--active); border-color: var(--active); color: white; }
  .status-filter-pill.sf-signed { background: var(--signed-bg); border-color: var(--signed-border); color: var(--signed); }
  .status-filter-pill.sf-signed.selected,
  .status-filter-pill.sf-signed:hover { background: var(--signed); border-color: var(--signed); color: white; }
  .status-filter-pill.sf-lapsed { background: var(--lapsed-bg); border-color: var(--lapsed-border); color: var(--lapsed); }
  .status-filter-pill.sf-lapsed.selected,
  .status-filter-pill.sf-lapsed:hover { background: var(--lapsed); border-color: var(--lapsed); color: white; }
  .status-filter-pill.sf-keyco { background: var(--keyco-bg); border-color: var(--keyco-border); color: var(--keyco); }
  .status-filter-pill.sf-keyco.selected,
  .status-filter-pill.sf-keyco:hover { background: var(--keyco); border-color: var(--keyco); color: white; }
  .status-filter-pill.sf-reachout { background: #EEF0FB; border-color: #B8BEEC; color: #4A55A2; }
  .status-filter-pill.sf-reachout.selected,
  .status-filter-pill.sf-reachout:hover { background: #4A55A2; border-color: #4A55A2; color: white; }

  /* ‚îÄ‚îÄ REACH OUT CARD ‚îÄ‚îÄ */
  .card.reachout-card { border-left: 3px solid #4A55A2; background: #EEF0FB; }
  .reachout-badge {
    display: inline-block;
    font-size: 0.65rem;
    padding: 2px 8px;
    border-radius: 20px;
    background: #4A55A2;
    color: white;
    font-weight: 700;
    letter-spacing: 0.04em;
    margin-bottom: 6px;
  }

  /* ‚îÄ‚îÄ NEW ROW BUTTON ‚îÄ‚îÄ */
  .btn-new-row {
    display: flex;
    align-items: center;
    gap: 7px;
    border: 1px solid var(--active-border);
    padding: 7px 16px;
    border-radius: 6px;
    font-family: 'DM Sans', sans-serif;
    font-size: 0.8rem;
    font-weight: 600;
    cursor: pointer;
    color: var(--active);
    background: var(--active-bg);
    transition: all 0.2s;
  }
  .btn-new-row:hover { background: var(--active); color: white; border-color: var(--active); }

  /* ‚îÄ‚îÄ MOBILE IMPROVEMENTS ‚îÄ‚îÄ */
  @media (max-width: 768px) {
    .header-top { padding: 14px 16px 0; flex-wrap: wrap; gap: 12px; }
    .brand h1 { font-size: 1.4rem; }
    .sub-nav { padding: 0 16px; overflow-x: auto; flex-wrap: nowrap; -webkit-overflow-scrolling: touch; }
    .sub-tab { padding: 10px 14px; font-size: 0.72rem; white-space: nowrap; }
    .page { padding: 20px 16px; }
    .page-title { font-size: 1.5rem; }
    .pipeline-wrap { gap: 10px; }
    .stage-col { min-width: 180px; }
    .filters { gap: 8px; }
    .search-box { min-width: 0; flex: 1; }
    .filter-select { font-size: 0.8rem; }
    .stat-row { gap: 8px; }
    .stat-pill { padding: 8px 12px; font-size: 0.75rem; }
    .stat-pill .count { font-size: 1.1rem; }
    .cards-grid { grid-template-columns: repeat(auto-fill, minmax(180px, 1fr)); }
    .header-actions { padding-bottom: 12px; }
    /* Progression page header on mobile */
    #page-progression .page-header { flex-direction: column; align-items: stretch; }
    #page-progression .page-header > div:last-child { flex-wrap: wrap; }
    /* Table wrap full width on mobile */
    .table-wrap { max-height: calc(100vh - 260px); }
    /* New modal fields */
    .modal-overlay { padding: 16px; }
    .modal-box { padding: 20px; }
    .modal-grid { grid-template-columns: 1fr !important; }
  }
  @media (max-width: 480px) {
    .header-top { flex-direction: column; align-items: flex-start; gap: 8px; }
    .main-nav { display: none; }
    .header-actions { padding-bottom: 8px; }
    .status-filter-row { gap: 6px; }
    .status-filter-pill { padding: 5px 12px; font-size: 0.68rem; }
  }

  /* ‚îÄ‚îÄ ADD ROW MODAL ‚îÄ‚îÄ */
  .modal-overlay {
    display: none;
    position: fixed;
    inset: 0;
    background: rgba(0,0,0,0.45);
    z-index: 1000;
    align-items: center;
    justify-content: center;
    padding: 24px;
  }
  .modal-overlay.open { display: flex; }
  .modal-box {
    background: var(--white);
    border-radius: 14px;
    padding: 28px;
    width: 100%;
    max-width: 640px;
    max-height: 90vh;
    overflow-y: auto;
    box-shadow: 0 20px 60px rgba(0,0,0,0.2);
    position: relative;
  }
  .modal-title {
    font-family: 'DM Serif Display', serif;
    font-size: 1.4rem;
    color: var(--dark);
    margin-bottom: 20px;
  }
  .modal-grid {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 14px;
    margin-bottom: 20px;
  }
  .modal-field { display: flex; flex-direction: column; gap: 5px; }
  .modal-field label { font-size: 0.72rem; font-weight: 700; text-transform: uppercase; letter-spacing: 0.06em; color: var(--muted); }
  .modal-field input, .modal-field select {
    background: var(--cream);
    border: 1px solid var(--border);
    border-radius: 7px;
    padding: 9px 12px;
    color: var(--dark);
    font-family: 'DM Sans', sans-serif;
    font-size: 0.85rem;
    outline: none;
    transition: border-color 0.2s;
  }
  .modal-field input:focus, .modal-field select:focus { border-color: var(--active); background: var(--white); }
  .modal-field.span-2 { grid-column: span 2; }
  .modal-actions { display: flex; gap: 10px; justify-content: flex-end; }
  .btn-modal-cancel {
    border: 1px solid var(--border);
    padding: 9px 20px;
    border-radius: 7px;
    font-family: 'DM Sans', sans-serif;
    font-size: 0.85rem;
    font-weight: 600;
    cursor: pointer;
    background: transparent;
    color: var(--muted);
    transition: all 0.2s;
  }
  .btn-modal-cancel:hover { background: var(--cream-dark); color: var(--dark); }
  .btn-modal-save {
    border: none;
    padding: 9px 24px;
    border-radius: 7px;
    font-family: 'DM Sans', sans-serif;
    font-size: 0.85rem;
    font-weight: 700;
    cursor: pointer;
    background: var(--active);
    color: white;
    transition: all 0.2s;
  }
  .btn-modal-save:hover { background: var(--dark); }
  .modal-close {
    position: absolute;
    top: 16px; right: 18px;
    background: none;
    border: none;
    cursor: pointer;
    color: var(--muted);
    font-size: 1.3rem;
    line-height: 1;
    transition: color 0.2s;
  }
  .modal-close:hover { color: var(--dark); }
</style>
</head>
<body>

<!-- Auth checking overlay -->
<div id="auth-checking">
  <div class="auth-spinner"></div>
  <p>Verifying access‚Ä¶</p>
</div>

<!-- Access denied screen -->
<div id="access-denied">
  <h2>Access Restricted</h2>
  <p>This page is only available to Woodates administrators. Please log in with an admin account.</p>
  <a href="index.html">‚Üê Back to Portal</a>
</div>

<header>
  <div class="header-top">
    <div class="brand">
      <p>Woodates</p>
      <h1>Leads</h1>
    </div>
    <div class="main-nav">
      <div class="main-nav-tab">Leads</div>
    </div>
    <div class="header-actions">
      <a href="index.html" class="btn-outline">‚Üê Home</a>
    </div>
  </div>
  <div class="sub-nav">
    <div class="sub-tab active" onclick="switchSubTab('pipeline', this)">Pipeline</div>
    <div class="sub-tab" onclick="switchSubTab('progression', this)">Progression</div>
    <div class="sub-tab" onclick="switchSubTab('masterlist', this)">Master List</div>
  </div>
</header>

<!-- ‚ïê‚ïê PIPELINE PAGE ‚ïê‚ïê -->
<div class="page active" id="page-pipeline">
  <div class="page-header">
    <div class="page-title">Active Pipeline</div>
    <div class="page-subtitle">Kanban view ‚Äî As of 11 Feb 2026</div>
  </div>
  <div class="status-filter-row">
    <div class="status-filter-pill sf-all selected" onclick="setPipelineFilter('ALL', this)"><span class="pill-count" id="pill-count-all"></span>All</div>
    <div class="status-filter-pill sf-active" onclick="setPipelineFilter('ACTIVE', this)"><span class="pill-count" id="pill-count-active"></span>Active</div>
    <div class="status-filter-pill sf-signed" onclick="setPipelineFilter('SIGNED', this)"><span class="pill-count" id="pill-count-signed"></span>Signed</div>
    <div class="status-filter-pill sf-lapsed" onclick="setPipelineFilter('LAPSED', this)"><span class="pill-count" id="pill-count-lapsed"></span>Lapsed</div>
    <div class="status-filter-pill sf-keyco" onclick="setPipelineFilter('KEYCO', this)"><span class="pill-count" id="pill-count-keyco"></span>Key Collection</div>
    <div class="status-filter-pill sf-reachout" onclick="setPipelineFilter('REACHOUT', this)">üîî Reach Out</div>
  </div>
  <div class="filters">
    <input class="search-box" type="text" placeholder="Search by name, phone, PM‚Ä¶" oninput="filterPipeline()" id="pipeline-search">
    <select class="filter-select" onchange="filterPipeline()" id="pipeline-pm-filter">
      <option value="">All PMs</option>
    </select>
    <select class="filter-select" onchange="filterPipeline()" id="pipeline-type-filter">
      <option value="">All Types</option>
    </select>
  </div>

  <!-- REACH OUT SECTION -->
  <div id="section-reachout" style="display:none">
    <div class="section-header">
      <div class="section-label">
        <div class="section-dot" style="background:#4A55A2"></div>
        <span class="section-title" style="color:#4A55A2">Reach Out Now</span>
        <span class="section-count" id="cnt-reachout"></span>
      </div>
    </div>
    <div class="cards-grid" id="cards-reachout"></div>
  </div>

  <div id="section-active">
  <div class="section-header">
    <div class="section-label">
      <div class="section-dot" style="background:var(--active)"></div>
      <span class="section-title" style="color:var(--active)">Active Pipeline</span>
      <span class="section-count" id="cnt-active"></span>
    </div>
  </div>
  <div class="pipeline-wrap" id="kanban-active"></div>
  </div>

  <div id="section-keyco">
  <div class="section-header">
    <div class="section-label">
      <div class="section-dot" style="background:var(--keyco)"></div>
      <span class="section-title" style="color:var(--keyco)">Long Key Collection</span>
      <span class="section-count" id="cnt-keyco"></span>
    </div>
    <button class="toggle-btn" onclick="toggleSection('keyco-body', this)">Hide</button>
  </div>
  <div class="collapsible-content" id="keyco-body" style="max-height:2000px">
    <div class="cards-grid" id="cards-keyco"></div>
  </div>
  </div>

  <div id="section-signed">
  <div class="section-header">
    <div class="section-label">
      <div class="section-dot" style="background:var(--signed)"></div>
      <span class="section-title" style="color:var(--signed)">Signed</span>
      <span class="section-count" id="cnt-signed-pipeline"></span>
    </div>
    <button class="toggle-btn" onclick="toggleSection('signed-body-pipeline', this)">Hide</button>
  </div>
  <div class="collapsible-content" id="signed-body-pipeline" style="max-height:2000px">
    <div class="cards-grid" id="cards-signed-pipeline"></div>
  </div>
  </div>

  <div id="section-lapsed">
  <div class="section-header">
    <div class="section-label">
      <div class="section-dot" style="background:var(--lapsed)"></div>
      <span class="section-title" style="color:var(--lapsed)">Lapsed</span>
      <span class="section-count" id="cnt-lapsed"></span>
    </div>
    <button class="toggle-btn" onclick="toggleSection('lapsed-body', this)">Hide</button>
  </div>
  <div class="collapsible-content" id="lapsed-body" style="max-height:9999px">
    <div class="cards-grid" id="cards-lapsed"></div>
  </div>
  </div>
</div>

<!-- ‚ïê‚ïê PROGRESSION PAGE ‚ïê‚ïê -->
<div class="page" id="page-progression">
  <div class="page-header" style="display:flex;align-items:flex-start;justify-content:space-between;flex-wrap:wrap;gap:12px">
    <div>
      <div class="page-title">Progression</div>
      <div class="page-subtitle">Full pipeline tracking ‚Äî all columns A‚ÄìT</div>
    </div>
    <div style="display:flex;gap:10px;flex-wrap:wrap;align-items:center">
      <button class="btn-new-row" onclick="openNewRowModal()">
        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/></svg>
        New
      </button>
      <button class="btn-edit-toggle" id="edit-toggle-btn" onclick="toggleEditMode()">
        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><path d="M11 4H4a2 2 0 00-2 2v14a2 2 0 002 2h14a2 2 0 002-2v-7"/><path d="M18.5 2.5a2.121 2.121 0 013 3L12 15l-4 1 1-4 9.5-9.5z"/></svg>
        Edit
      </button>
      <button class="btn-download" onclick="downloadExcel()">
        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><path d="M21 15v4a2 2 0 01-2 2H5a2 2 0 01-2-2v-4"/><polyline points="7 10 12 15 17 10"/><line x1="12" y1="15" x2="12" y2="3"/></svg>
        Download Excel
      </button>
    </div>
  </div>

  <div class="edit-banner" id="edit-banner">
    <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><circle cx="12" cy="12" r="10"/><line x1="12" y1="8" x2="12" y2="12"/><line x1="12" y1="16" x2="12.01" y2="16"/></svg>
    Editing mode is on ‚Äî click any cell to edit. Changes are local only.
  </div>

  <div class="filters">
    <input class="search-box" type="text" placeholder="Search by name, phone, PM, status‚Ä¶" oninput="filterProgression()" id="prog-search">
    <select class="filter-select" onchange="filterProgression()" id="prog-status-filter">
      <option value="">All Statuses</option>
      <option value="ACTIVE">Active</option>
      <option value="SIGNED">Signed</option>
      <option value="LAPSED">Lapsed</option>
      <option value="LONG KEY COLLECTION">Long Key Collection</option>
    </select>
    <select class="filter-select" onchange="filterProgression()" id="prog-pm-filter">
      <option value="">All PMs</option>
    </select>
  </div>

  <div class="table-wrap" id="prog-table-wrap">
    <table class="w-table" id="prog-table">
      <thead>
        <tr>
          <th>A ¬∑ #</th>
          <th>B ¬∑ Date</th>
          <th>C ¬∑ Source</th>
          <th>D ¬∑ Phone</th>
          <th>E ¬∑ Type</th>
          <th>F ¬∑ Name</th>
          <th>Current Status</th>
          <th>G ¬∑ Responsive?</th>
          <th>H ¬∑ GC Created</th>
          <th>I ¬∑ PM</th>
          <th>J ¬∑ 1st Meet</th>
          <th>K ¬∑ 2D</th>
          <th>L ¬∑ Quotation</th>
          <th>M ¬∑ 2nd Meet</th>
          <th>N ¬∑ Revised 2D</th>
          <th>O ¬∑ Revised Quot.</th>
          <th>P ¬∑ Site Visit</th>
          <th>Q ¬∑ Comments</th>
          <th>R ¬∑ 1st Deposit</th>
          <th>S ¬∑ 2nd Deposit</th>
          <th>T ¬∑ Final Status</th>
        </tr>
      </thead>
      <tbody id="prog-tbody"></tbody>
    </table>
  </div>
</div>

<!-- ‚ïê‚ïê MASTER LIST PAGE ‚ïê‚ïê -->
<div class="page" id="page-masterlist">
  <div class="page-header">
    <div class="page-title">Master List</div>
    <div class="page-subtitle">91 leads ‚Äî As of 11 Feb 2026</div>
  </div>
  <div class="filters">
    <input class="search-box" type="text" placeholder="Search by name, phone, property type‚Ä¶" oninput="filterMaster()" id="master-search">
    <select class="filter-select" onchange="filterMaster()" id="master-type-filter">
      <option value="">All Property Types</option>
    </select>
  </div>
  <div class="table-wrap" style="max-width:600px">
    <table class="w-table" id="master-table">
      <thead>
        <tr>
          <th style="width:40px">#</th>
          <th>Name</th>
          <th>Phone</th>
          <th>Property Type</th>
        </tr>
      </thead>
      <tbody id="master-tbody"></tbody>
    </table>
  </div>
</div>

<!-- ‚ïê‚ïê ADD ROW MODAL ‚ïê‚ïê -->
<div class="modal-overlay" id="new-row-modal">
  <div class="modal-box">
    <button class="modal-close" onclick="closeNewRowModal()">‚úï</button>
    <div class="modal-title">Add New Lead</div>
    <div class="modal-grid">
      <div class="modal-field">
        <label>Date</label>
        <input type="text" id="new-date" placeholder="e.g. 20 Feb 2026">
      </div>
      <div class="modal-field">
        <label>Source</label>
        <input type="text" id="new-source" placeholder="e.g. Ad">
      </div>
      <div class="modal-field">
        <label>Phone</label>
        <input type="text" id="new-phone" placeholder="e.g. 91234567">
      </div>
      <div class="modal-field">
        <label>Property Type</label>
        <select id="new-type">
          <option value="">‚Äî Select ‚Äî</option>
          <option>BTO</option>
          <option>Resale</option>
          <option>Condo</option>
          <option>EC</option>
          <option>Resale</option>
          <option>Bungalow</option>
          <option>Current</option>
        </select>
      </div>
      <div class="modal-field span-2">
        <label>Name *</label>
        <input type="text" id="new-name" placeholder="Customer name">
      </div>
      <div class="modal-field span-2">
        <label>Comments</label>
        <input type="text" id="new-comments" placeholder="Any notes‚Ä¶">
      </div>
      <div class="modal-field">
        <label>Final Status</label>
        <select id="new-status">
          <option value="ACTIVE">Active</option>
          <option value="LAPSED">Lapsed</option>
          <option value="SIGNED">Signed</option>
          <option value="LONG KEY COLLECTION">Long Key Collection</option>
        </select>
      </div>
      <div class="modal-field">
        <label>Stage</label>
        <select id="new-stage">
          <option value="New Lead">New Lead</option>
          <option value="Responsive">Responsive</option>
          <option value="GC Created">GC Created</option>
          <option value="1st Meeting">1st Meeting</option>
          <option value="2D">2D</option>
          <option value="Quotation">Quotation</option>
          <option value="2nd Meeting">2nd Meeting</option>
          <option value="Revised 2D">Revised 2D</option>
          <option value="Revised Quotation">Revised Quotation</option>
          <option value="Site Visit">Site Visit</option>
          <option value="1st Deposit">1st Deposit</option>
          <option value="2nd Deposit">2nd Deposit</option>
        </select>
      </div>
    </div>
    <div class="modal-actions">
      <button class="btn-modal-cancel" onclick="closeNewRowModal()">Cancel</button>
      <button class="btn-modal-save" onclick="saveNewRow()">Add Lead</button>
    </div>
  </div>
</div>

<script>
// ‚îÄ‚îÄ SUPABASE ADMIN AUTH GUARD ‚îÄ‚îÄ
(async function() {
  const { createClient } = supabase;
  const _supabase = createClient(
    'https://ilytehukqrkwpupdpkgo.supabase.co',
    'sb_publishable_tNMpLdZaqm0e-El_LP4kKg_fhfj-ARF'
  );

  const authChecking = document.getElementById('auth-checking');
  const accessDenied = document.getElementById('access-denied');

  try {
    const { data: { session } } = await _supabase.auth.getSession();
    if (!session) {
      authChecking.style.display = 'none';
      accessDenied.style.display = 'flex';
      return;
    }
    const { data: profile } = await _supabase
      .from('profiles')
      .select('role, full_name')
      .eq('id', session.user.id)
      .single();

    if (!profile || profile.role !== 'admin') {
      authChecking.style.display = 'none';
      accessDenied.style.display = 'flex';
      return;
    }

    // Access granted ‚Äî show the page
    authChecking.style.display = 'none';
    document.body.style.display = 'block';
  } catch(e) {
    authChecking.style.display = 'none';
    accessDenied.style.display = 'flex';
  }
})();

// ‚îÄ‚îÄ DATA ‚îÄ‚îÄ
const CHYLER_DATA = [{"Date":"01 Jan 2026","Number":2,"Source":"Ad","Phone":91910069,"Type":"Current","Name":"Rose","Responsive?":"NO","GC created":null,"PM":null,"1st meet":null,"2D":null,"Quotation":null,"2nd meet":null,"Revised 2D":null,"Revised Quotation":null,"Site visit":null,"Comments":null,"1st Deposit":null,"2nd Deposit":null,"FINAL STATUS":"LAPSED","stage":"New Lead"},{"Date":"02 Jan 2026","Number":3,"Source":"Ad","Phone":85991413,"Type":"BTO","Name":"Mark","Responsive?":"NO","GC created":null,"PM":null,"1st meet":null,"2D":null,"Quotation":null,"2nd meet":null,"Revised 2D":null,"Revised Quotation":null,"Site visit":null,"Comments":null,"1st Deposit":null,"2nd Deposit":null,"FINAL STATUS":"LAPSED","stage":"New Lead"},{"Date":"04 Jan 2026","Number":5,"Source":"Ad","Phone":96886932,"Type":"Condo","Name":"YQ","Responsive?":"NO","GC created":null,"PM":null,"1st meet":null,"2D":null,"Quotation":null,"2nd meet":null,"Revised 2D":null,"Revised Quotation":null,"Site visit":null,"Comments":"Customer don\u2019t want to provide correct floor plan","1st Deposit":null,"2nd Deposit":null,"FINAL STATUS":"LAPSED","stage":"New Lead"},{"Date":"04 Jan 2026","Number":6,"Source":"Ad","Phone":90119256,"Type":"BTO","Name":"SiMin","Responsive?":"NO","GC created":null,"PM":null,"1st meet":null,"2D":null,"Quotation":null,"2nd meet":null,"Revised 2D":null,"Revised Quotation":null,"Site visit":null,"Comments":"Customer wants 3D render before deposit","1st Deposit":null,"2nd Deposit":null,"FINAL STATUS":"LAPSED","stage":"New Lead"},{"Date":"05 Jan 2026","Number":8,"Source":"Ad","Phone":81185205,"Type":"BTO","Name":"Kasim","Responsive?":"YES","GC created":"YES","PM":"XUEQI","1st meet":"YES","2D":"YES","Quotation":"YES","2nd meet":"YES","Revised 2D":"YES","Revised Quotation":"YES","Site visit":"NO","Comments":null,"1st Deposit":"YES","2nd Deposit":null,"FINAL STATUS":"SIGNED","stage":"1st Deposit"},{"Date":"05 Jan 2026","Number":9,"Source":"Ad","Phone":92370923,"Type":"Resale","Name":"Hana","Responsive?":"NO","GC created":"YES","PM":"BOSS CHONG","1st meet":"NO","2D":null,"Quotation":null,"2nd meet":null,"Revised 2D":null,"Revised Quotation":null,"Site visit":null,"Comments":"Customer change of renovation plans","1st Deposit":null,"2nd Deposit":null,"FINAL STATUS":"LAPSED","stage":"GC Created"},{"Date":"06 Jan 2026","Number":10,"Source":"Ad","Phone":87920605,"Type":"BTO","Name":"WaWa","Responsive?":"YES","GC created":"YES","PM":"QUEENIE","1st meet":"YES","2D":"YES","Quotation":null,"2nd meet":null,"Revised 2D":null,"Revised Quotation":null,"Site visit":null,"Comments":"Customer not responsive after preliminary call","1st Deposit":null,"2nd Deposit":null,"FINAL STATUS":"LAPSED","stage":"2D"},{"Date":"06 Jan 2026","Number":11,"Source":"Ad","Phone":88625848,"Type":"BTO","Name":"Yun Wen","Responsive?":"YES","GC created":"YES","PM":"XUEQI","1st meet":"YES","2D":"YES","Quotation":"YES","2nd meet":null,"Revised 2D":null,"Revised Quotation":null,"Site visit":null,"Comments":"Customer moved to competitor","1st Deposit":null,"2nd Deposit":null,"FINAL STATUS":"LAPSED","stage":"Quotation"},{"Date":"08 Jan 2026","Number":12,"Source":"Ad","Phone":96874495,"Type":"BTO","Name":"Aletheia","Responsive?":"NO","GC created":null,"PM":null,"1st meet":null,"2D":null,"Quotation":null,"2nd meet":null,"Revised 2D":null,"Revised Quotation":null,"Site visit":null,"Comments":"Customer key collection Q1 2027","1st Deposit":null,"2nd Deposit":null,"FINAL STATUS":"LONG KEY COLLECTION","stage":"New Lead"},{"Date":"08 Jan 2026","Number":13,"Source":"Ad","Phone":87211980,"Type":"BTO","Name":"Lucas","Responsive?":"NO","GC created":null,"PM":null,"1st meet":null,"2D":null,"Quotation":null,"2nd meet":null,"Revised 2D":null,"Revised Quotation":null,"Site visit":null,"Comments":"Customer key collection Q1 2028","1st Deposit":null,"2nd Deposit":null,"FINAL STATUS":"LONG KEY COLLECTION","stage":"New Lead"},{"Date":"09 Jan 2026","Number":14,"Source":"Ad","Phone":87884799,"Type":"BTO","Name":"Jacky","Responsive?":"NO","GC created":null,"PM":null,"1st meet":null,"2D":null,"Quotation":null,"2nd meet":null,"Revised 2D":null,"Revised Quotation":null,"Site visit":null,"Comments":null,"1st Deposit":null,"2nd Deposit":null,"FINAL STATUS":"LAPSED","stage":"New Lead"},{"Date":"07 Jan 2026","Number":15,"Source":"Ad","Phone":93890756,"Type":"BTO","Name":"MingWei","Responsive?":"NO","GC created":"YES","PM":"XUEQI","1st meet":"YES","2D":"YES","Quotation":"YES","2nd meet":null,"Revised 2D":null,"Revised Quotation":null,"Site visit":null,"Comments":"Customer moved to competitor","1st Deposit":null,"2nd Deposit":null,"FINAL STATUS":"LAPSED","stage":"Quotation"},{"Date":"09 Jan 2026","Number":16,"Source":"Ad","Phone":91019940,"Type":"BTO","Name":"Arliana","Responsive?":"NO","GC created":null,"PM":null,"1st meet":null,"2D":null,"Quotation":null,"2nd meet":null,"Revised 2D":null,"Revised Quotation":null,"Site visit":null,"Comments":"Min Spend < $5k","1st Deposit":null,"2nd Deposit":null,"FINAL STATUS":"LAPSED","stage":"New Lead"},{"Date":"11 Jan 2026","Number":17,"Source":"Ad","Phone":87675695,"Type":"BTO","Name":"Ameera","Responsive?":"NO","GC created":null,"PM":null,"1st meet":null,"2D":null,"Quotation":null,"2nd meet":null,"Revised 2D":null,"Revised Quotation":null,"Site visit":null,"Comments":"Customer key collection Q4 2027","1st Deposit":null,"2nd Deposit":null,"FINAL STATUS":"LONG KEY COLLECTION","stage":"New Lead"},{"Date":"10 Jan 2026","Number":18,"Source":"Ad","Phone":90886770,"Type":"BTO","Name":"Alan Lau","Responsive?":"YES","GC created":"YES","PM":"PENGFEI","1st meet":"YES","2D":"YES","Quotation":"YES","2nd meet":"YES","Revised 2D":"YES","Revised Quotation":"YES","Site visit":null,"Comments":null,"1st Deposit":null,"2nd Deposit":null,"FINAL STATUS":"ACTIVE","stage":"Revised Quotation"},{"Date":"11 Jan 2026","Number":19,"Source":"Ad","Phone":81630703,"Type":"Resale","Name":"Mel","Responsive?":"NO","GC created":null,"PM":null,"1st meet":null,"2D":null,"Quotation":null,"2nd meet":null,"Revised 2D":null,"Revised Quotation":null,"Site visit":null,"Comments":null,"1st Deposit":null,"2nd Deposit":null,"FINAL STATUS":"LAPSED","stage":"New Lead"},{"Date":"12 Jan 2026","Number":20,"Source":"Ad","Phone":97231378,"Type":"BTO","Name":"Joanne","Responsive?":"NO","GC created":null,"PM":null,"1st meet":null,"2D":null,"Quotation":null,"2nd meet":null,"Revised 2D":null,"Revised Quotation":null,"Site visit":null,"Comments":"Customer key collection Q4 2026","1st Deposit":null,"2nd Deposit":null,"FINAL STATUS":"LONG KEY COLLECTION","stage":"New Lead"},{"Date":"09 Jan 2026","Number":21,"Source":"Ad","Phone":81803560,"Type":"BTO","Name":"Fun","Responsive?":"NO","GC created":null,"PM":null,"1st meet":null,"2D":null,"Quotation":null,"2nd meet":null,"Revised 2D":null,"Revised Quotation":null,"Site visit":null,"Comments":"Customer key collection Q2 2027","1st Deposit":null,"2nd Deposit":null,"FINAL STATUS":"LONG KEY COLLECTION","stage":"New Lead"},{"Date":"12 Jan 2026","Number":22,"Source":"Ad","Phone":97938763,"Type":"BTO","Name":"Adrian","Responsive?":"YES","GC created":"YES","PM":"QUEENIE","1st meet":"YES","2D":"YES","Quotation":"YES","2nd meet":null,"Revised 2D":null,"Revised Quotation":null,"Site visit":null,"Comments":null,"1st Deposit":null,"2nd Deposit":null,"FINAL STATUS":"SIGNED","stage":"Quotation"},{"Date":"12 Jan 2026","Number":23,"Source":"Ad","Phone":86535024,"Type":"BTO","Name":"Jasmine","Responsive?":"NO","GC created":null,"PM":null,"1st meet":null,"2D":null,"Quotation":null,"2nd meet":null,"Revised 2D":null,"Revised Quotation":null,"Site visit":null,"Comments":"SBF, cannot locate floorplan in SingPass","1st Deposit":null,"2nd Deposit":null,"FINAL STATUS":"LAPSED","stage":"New Lead"},{"Date":"07 Jan 2026","Number":24,"Source":"Ad","Phone":97570544,"Type":"Resale","Name":"Teesha","Responsive?":"YES","GC created":null,"PM":"BOSS CHONG","1st meet":null,"2D":null,"Quotation":null,"2nd meet":null,"Revised 2D":null,"Revised Quotation":null,"Site visit":null,"Comments":"Pending partial quotation","1st Deposit":null,"2nd Deposit":null,"FINAL STATUS":"ACTIVE","stage":"Responsive"},{"Date":"12 Jan 2026","Number":25,"Source":"Ad","Phone":97479320,"Type":"Resale","Name":"Ily","Responsive?":"NO","GC created":null,"PM":null,"1st meet":null,"2D":null,"Quotation":null,"2nd meet":null,"Revised 2D":null,"Revised Quotation":null,"Site visit":null,"Comments":null,"1st Deposit":null,"2nd Deposit":null,"FINAL STATUS":"LAPSED","stage":"New Lead"},{"Date":"15 Jan 2026","Number":26,"Source":"Ad","Phone":96563892,"Type":"BTO","Name":"Kenneth","Responsive?":"YES","GC created":"YES","PM":"XUEQI","1st meet":"YES","2D":"YES","Quotation":"YES","2nd meet":"YES","Revised 2D":"YES","Revised Quotation":"YES","Site visit":null,"Comments":null,"1st Deposit":null,"2nd Deposit":null,"FINAL STATUS":"ACTIVE","stage":"Revised Quotation"},{"Date":"15 Jan 2026","Number":27,"Source":"Ad","Phone":96326559,"Type":"BTO","Name":"Joy","Responsive?":"NO","GC created":"YES","PM":"QUEENIE","1st meet":null,"2D":null,"Quotation":null,"2nd meet":null,"Revised 2D":null,"Revised Quotation":null,"Site visit":null,"Comments":null,"1st Deposit":null,"2nd Deposit":null,"FINAL STATUS":"LAPSED","stage":"GC Created"},{"Date":"16 Jan 2026","Number":28,"Source":"Ad","Phone":91594495,"Type":"BTO","Name":"Stefie Chia","Responsive?":"NO","GC created":null,"PM":null,"1st meet":null,"2D":null,"Quotation":null,"2nd meet":null,"Revised 2D":null,"Revised Quotation":null,"Site visit":null,"Comments":"Customer key collection Q4 2026","1st Deposit":null,"2nd Deposit":null,"FINAL STATUS":"LONG KEY COLLECTION","stage":"New Lead"},{"Date":"18 Jan 2026","Number":29,"Source":"Ad","Phone":98470470,"Type":"BTO","Name":"Krissy","Responsive?":"NO","GC created":null,"PM":null,"1st meet":null,"2D":null,"Quotation":null,"2nd meet":null,"Revised 2D":null,"Revised Quotation":null,"Site visit":null,"Comments":"Customer key collection Q4 2026","1st Deposit":null,"2nd Deposit":null,"FINAL STATUS":"LONG KEY COLLECTION","stage":"New Lead"},{"Date":"11 Jan 2026","Number":30,"Source":"Ad","Phone":87831491,"Type":"Resale","Name":"Esmie","Responsive?":"NO","GC created":null,"PM":null,"1st meet":null,"2D":null,"Quotation":null,"2nd meet":null,"Revised 2D":null,"Revised Quotation":null,"Site visit":null,"Comments":null,"1st Deposit":null,"2nd Deposit":null,"FINAL STATUS":"LAPSED","stage":"New Lead"},{"Date":"15 Jan 2026","Number":31,"Source":"Ad","Phone":98566883,"Type":"BTO","Name":"Eric","Responsive?":"NO","GC created":null,"PM":null,"1st meet":null,"2D":null,"Quotation":null,"2nd meet":null,"Revised 2D":null,"Revised Quotation":null,"Site visit":null,"Comments":null,"1st Deposit":null,"2nd Deposit":null,"FINAL STATUS":"LAPSED","stage":"New Lead"},{"Date":"08 Jan 2026","Number":32,"Source":"Ad","Phone":91849022,"Type":"BTO","Name":"Shawal","Responsive?":"YES","GC created":"YES","PM":"QUEENIE","1st meet":"YES","2D":"YES","Quotation":"YES","2nd meet":null,"Revised 2D":null,"Revised Quotation":null,"Site visit":null,"Comments":"Moved to competitor","1st Deposit":null,"2nd Deposit":null,"FINAL STATUS":"LAPSED","stage":"Quotation"},{"Date":"21 Jan 2026","Number":33,"Source":"Ad","Phone":91099209,"Type":"BTO","Name":"William","Responsive?":"NO","GC created":null,"PM":null,"1st meet":null,"2D":null,"Quotation":null,"2nd meet":null,"Revised 2D":null,"Revised Quotation":null,"Site visit":null,"Comments":null,"1st Deposit":null,"2nd Deposit":null,"FINAL STATUS":"LAPSED","stage":"New Lead"},{"Date":"22 Jan 2026","Number":34,"Source":"Ad","Phone":96487166,"Type":"BTO","Name":"Construction","Responsive?":"NO","GC created":null,"PM":null,"1st meet":null,"2D":null,"Quotation":null,"2nd meet":null,"Revised 2D":null,"Revised Quotation":null,"Site visit":null,"Comments":null,"1st Deposit":null,"2nd Deposit":null,"FINAL STATUS":"LAPSED","stage":"New Lead"},{"Date":"20 Jan 2026","Number":35,"Source":"Ad","Phone":81614001,"Type":"BTO","Name":"Aaron","Responsive?":"YES","GC created":"YES","PM":"QUEENIE","1st meet":"YES","2D":"YES","Quotation":"YES","2nd meet":null,"Revised 2D":null,"Revised Quotation":null,"Site visit":null,"Comments":null,"1st Deposit":null,"2nd Deposit":null,"FINAL STATUS":"ACTIVE","stage":"Quotation"},{"Date":"20 Jan 2026","Number":36,"Source":"Ad","Phone":98310669,"Type":"BTO","Name":"Dominic","Responsive?":"YES","GC created":"YES","PM":"QUEENIE","1st meet":"YES","2D":"YES","Quotation":"YES","2nd meet":"YES","Revised 2D":null,"Revised Quotation":null,"Site visit":null,"Comments":null,"1st Deposit":null,"2nd Deposit":null,"FINAL STATUS":"SIGNED","stage":"2nd Meeting"},{"Date":"20 Jan 2026","Number":37,"Source":"Ad","Phone":91878995,"Type":"BTO","Name":"Yana","Responsive?":"YES","GC created":"YES","PM":"PENGFEI","1st meet":"YES","2D":"YES","Quotation":"YES","2nd meet":null,"Revised 2D":null,"Revised Quotation":null,"Site visit":null,"Comments":null,"1st Deposit":null,"2nd Deposit":null,"FINAL STATUS":"ACTIVE","stage":"Quotation"},{"Date":"22 Jan 2026","Number":38,"Source":"Ad","Phone":84982194,"Type":"Resale","Name":"LeeKee","Responsive?":"YES","GC created":"YES","PM":"SHAN","1st meet":null,"2D":null,"Quotation":null,"2nd meet":null,"Revised 2D":null,"Revised Quotation":null,"Site visit":null,"Comments":null,"1st Deposit":null,"2nd Deposit":null,"FINAL STATUS":"ACTIVE","stage":"GC Created"},{"Date":"25 Jan 2026","Number":39,"Source":"Ad","Phone":87009331,"Type":"BTO","Name":"Doreen","Responsive?":"NO","GC created":null,"PM":null,"1st meet":null,"2D":null,"Quotation":null,"2nd meet":null,"Revised 2D":null,"Revised Quotation":null,"Site visit":null,"Comments":null,"1st Deposit":null,"2nd Deposit":null,"FINAL STATUS":"LAPSED","stage":"New Lead"},{"Date":"23 Jan 2026","Number":40,"Source":"Ad","Phone":83332661,"Type":null,"Name":"Alson","Responsive?":"YES","GC created":null,"PM":null,"1st meet":null,"2D":null,"Quotation":null,"2nd meet":null,"Revised 2D":null,"Revised Quotation":null,"Site visit":null,"Comments":"looking for carpenter provider, passed him Chong's number","1st Deposit":null,"2nd Deposit":null,"FINAL STATUS":"LAPSED","stage":"Responsive"},{"Date":"03 Jan 2026","Number":41,"Source":"Ad","Phone":87781660,"Type":"BTO","Name":"Chin Yee","Responsive?":"YES","GC created":"YES","PM":"XUEQI","1st meet":"YES","2D":"YES","Quotation":"YES","2nd meet":"YES","Revised 2D":"YES","Revised Quotation":"YES","Site visit":null,"Comments":null,"1st Deposit":null,"2nd Deposit":null,"FINAL STATUS":"ACTIVE","stage":"Revised Quotation"},{"Date":"23 Jan 2026","Number":42,"Source":"Ad","Phone":83681815,"Type":"BTO","Name":"Dareios","Responsive?":"NO","GC created":"YES","PM":"XUEQI","1st meet":"YES","2D":"YES","Quotation":"YES","2nd meet":null,"Revised 2D":null,"Revised Quotation":null,"Site visit":null,"Comments":null,"1st Deposit":null,"2nd Deposit":null,"FINAL STATUS":"LAPSED","stage":"Quotation"},{"Date":"24 Jan 2026","Number":43,"Source":"Ad","Phone":90309093,"Type":"BTO","Name":"Sky","Responsive?":"YES","GC created":"YES","PM":"QUEENIE","1st meet":"YES","2D":"YES","Quotation":"YES","2nd meet":null,"Revised 2D":null,"Revised Quotation":null,"Site visit":null,"Comments":"Moved to competitor","1st Deposit":null,"2nd Deposit":null,"FINAL STATUS":"LAPSED","stage":"Quotation"},{"Date":"26 Jan 2026","Number":44,"Source":"Ad","Phone":91715758,"Type":"BTO","Name":"Timothea","Responsive?":"YES","GC created":"YES","PM":"QUEENIE","1st meet":"YES","2D":"YES","Quotation":"YES","2nd meet":null,"Revised 2D":null,"Revised Quotation":null,"Site visit":null,"Comments":"Moved to competitor","1st Deposit":null,"2nd Deposit":null,"FINAL STATUS":"LAPSED","stage":"Quotation"},{"Date":"26 Jan 1900","Number":45,"Source":"Ad","Phone":83288915,"Type":"BTO","Name":"Lysha","Responsive?":"YES","GC created":"YES","PM":"QUEENIE","1st meet":"YES","2D":"YES","Quotation":"YES","2nd meet":"SCHEDULED","Revised 2D":null,"Revised Quotation":null,"Site visit":null,"Comments":null,"1st Deposit":null,"2nd Deposit":null,"FINAL STATUS":"ACTIVE","stage":"Quotation"},{"Date":"25 Jan 2026","Number":46,"Source":"Ad","Phone":92976611,"Type":"BTO","Name":"FangLing","Responsive?":"YES","GC created":"NO","PM":null,"1st meet":null,"2D":null,"Quotation":null,"2nd meet":null,"Revised 2D":null,"Revised Quotation":null,"Site visit":null,"Comments":"Does not want to join GC. Balia","1st Deposit":null,"2nd Deposit":null,"FINAL STATUS":"LAPSED","stage":"Responsive"},{"Date":"27 Jan 2026","Number":47,"Source":"Ad","Phone":91013901,"Type":"BTO","Name":"Jia Le","Responsive?":"YES","GC created":"YES","PM":"QUEENIE","1st meet":"SCHEDULED","2D":null,"Quotation":null,"2nd meet":null,"Revised 2D":null,"Revised Quotation":null,"Site visit":null,"Comments":"Pending floor plan","1st Deposit":null,"2nd Deposit":null,"FINAL STATUS":"ACTIVE","stage":"GC Created"},{"Date":"27 Jan 2026","Number":48,"Source":"Ad","Phone":81124522,"Type":"BTO","Name":"Aibo","Responsive?":"YES","GC created":"YES","PM":"QUEENIE","1st meet":"YES","2D":"YES","Quotation":"YES","2nd meet":null,"Revised 2D":null,"Revised Quotation":null,"Site visit":null,"Comments":"Pending floor plan","1st Deposit":null,"2nd Deposit":null,"FINAL STATUS":"ACTIVE","stage":"Quotation"},{"Date":"28 Jan 2026","Number":49,"Source":"Ad","Phone":96343371,"Type":"BTO","Name":"Qing Hao","Responsive?":"NO","GC created":null,"PM":null,"1st meet":null,"2D":null,"Quotation":null,"2nd meet":null,"Revised 2D":null,"Revised Quotation":null,"Site visit":null,"Comments":"Does not want to join GC. Long key collection","1st Deposit":null,"2nd Deposit":null,"FINAL STATUS":"LONG KEY COLLECTION","stage":"New Lead"},{"Date":"28 Jan 2026","Number":50,"Source":"Ad","Phone":87532512,"Type":"Resale","Name":"Hadi","Responsive?":null,"GC created":null,"PM":null,"1st meet":null,"2D":null,"Quotation":null,"2nd meet":null,"Revised 2D":null,"Revised Quotation":null,"Site visit":null,"Comments":null,"1st Deposit":null,"2nd Deposit":null,"FINAL STATUS":"LAPSED","stage":"New Lead"},{"Date":"28 Jan 2026","Number":51,"Source":"Ad","Phone":93380868,"Type":"BTO","Name":"Anita","Responsive?":"YES","GC created":"YES","PM":"XUEQI","1st meet":"YES","2D":"PENDING","Quotation":"PENDING","2nd meet":null,"Revised 2D":null,"Revised Quotation":null,"Site visit":null,"Comments":null,"1st Deposit":null,"2nd Deposit":null,"FINAL STATUS":"ACTIVE","stage":"1st Meeting"},{"Date":"27 Jan 2026","Number":52,"Source":"Ad","Phone":84245578,"Type":"Resale","Name":"Chandhi","Responsive?":"NO","GC created":null,"PM":null,"1st meet":null,"2D":null,"Quotation":null,"2nd meet":null,"Revised 2D":null,"Revised Quotation":null,"Site visit":null,"Comments":null,"1st Deposit":null,"2nd Deposit":null,"FINAL STATUS":"LAPSED","stage":"New Lead"},{"Date":"28 Jan 2026","Number":53,"Source":"Ad","Phone":97689238,"Type":"BTO","Name":"Chern Yung","Responsive?":"YES","GC created":"YES","PM":"XUEQI","1st meet":"YES","2D":"YES","Quotation":"YES","2nd meet":null,"Revised 2D":null,"Revised Quotation":null,"Site visit":null,"Comments":null,"1st Deposit":null,"2nd Deposit":null,"FINAL STATUS":"ACTIVE","stage":"Quotation"},{"Date":"29 Jan 2026","Number":54,"Source":"Ad","Phone":84345251,"Type":"Resale","Name":"XY Stella","Responsive?":"YES","GC created":null,"PM":null,"1st meet":null,"2D":null,"Quotation":null,"2nd meet":null,"Revised 2D":null,"Revised Quotation":null,"Site visit":null,"Comments":"Wants modifications on existing carpentry","1st Deposit":null,"2nd Deposit":null,"FINAL STATUS":"LAPSED","stage":"Responsive"},{"Date":"29 Jan 2026","Number":55,"Source":"Ad","Phone":96188672,"Type":"BTO","Name":"MeiYi","Responsive?":"NO","GC created":"YES","PM":"XUEQI","1st meet":"YES","2D":"YES","Quotation":null,"2nd meet":null,"Revised 2D":null,"Revised Quotation":null,"Site visit":null,"Comments":null,"1st Deposit":null,"2nd Deposit":null,"FINAL STATUS":"ACTIVE","stage":"2D"},{"Date":"29 Jan 2026","Number":56,"Source":"Ad","Phone":97237771,"Type":"BTO","Name":"Sharena","Responsive?":"YES","GC created":null,"PM":null,"1st meet":null,"2D":null,"Quotation":null,"2nd meet":null,"Revised 2D":null,"Revised Quotation":null,"Site visit":null,"Comments":"Key collection Q2 2027","1st Deposit":null,"2nd Deposit":null,"FINAL STATUS":"LONG KEY COLLECTION","stage":"Responsive"},{"Date":"29 Jan 2026","Number":57,"Source":"Ad","Phone":98796426,"Type":"BTO","Name":"Kelvin","Responsive?":"NO","GC created":"YES","PM":"XUEQI","1st meet":null,"2D":null,"Quotation":null,"2nd meet":null,"Revised 2D":null,"Revised Quotation":null,"Site visit":null,"Comments":null,"1st Deposit":null,"2nd Deposit":null,"FINAL STATUS":"LAPSED","stage":"GC Created"},{"Date":"29 Jan 2026","Number":58,"Source":"Ad","Phone":88428099,"Type":"BTO","Name":"Naz","Responsive?":null,"GC created":null,"PM":null,"1st meet":null,"2D":null,"Quotation":null,"2nd meet":null,"Revised 2D":null,"Revised Quotation":null,"Site visit":null,"Comments":"Key Collection Q4 2026","1st Deposit":null,"2nd Deposit":null,"FINAL STATUS":"LONG KEY COLLECTION","stage":"New Lead"},{"Date":"30 Jan 2026","Number":59,"Source":"Ad","Phone":98527959,"Type":"BTO","Name":"Charmyne","Responsive?":null,"GC created":null,"PM":null,"1st meet":null,"2D":null,"Quotation":null,"2nd meet":null,"Revised 2D":null,"Revised Quotation":null,"Site visit":null,"Comments":"Key Collection Q3 2027","1st Deposit":null,"2nd Deposit":null,"FINAL STATUS":"LONG KEY COLLECTION","stage":"New Lead"},{"Date":"30 Jan 2026","Number":60,"Source":"Ad","Phone":91525865,"Type":"Resale","Name":"Javier","Responsive?":null,"GC created":null,"PM":null,"1st meet":null,"2D":null,"Quotation":null,"2nd meet":null,"Revised 2D":null,"Revised Quotation":null,"Site visit":null,"Comments":"Less than < 5k","1st Deposit":null,"2nd Deposit":null,"FINAL STATUS":"LAPSED","stage":"New Lead"},{"Date":"31 Jan 2026","Number":61,"Source":"Ad","Phone":96202266,"Type":"BTO","Name":"Rani","Responsive?":"NO","GC created":null,"PM":null,"1st meet":null,"2D":null,"Quotation":null,"2nd meet":null,"Revised 2D":null,"Revised Quotation":null,"Site visit":null,"Comments":null,"1st Deposit":null,"2nd Deposit":null,"FINAL STATUS":"LAPSED","stage":"New Lead"},{"Date":"01 Feb 2026","Number":62,"Source":"Ad","Phone":88698191,"Type":"BTO","Name":"Derek","Responsive?":"YES","GC created":"YES","PM":"QUEENIE","1st meet":"YES","2D":"YES","Quotation":"YES","2nd meet":null,"Revised 2D":null,"Revised Quotation":null,"Site visit":null,"Comments":null,"1st Deposit":null,"2nd Deposit":null,"FINAL STATUS":"ACTIVE","stage":"Quotation"},{"Date":"01 Feb 2026","Number":63,"Source":"Ad","Phone":97563961,"Type":"BTO","Name":"Stacey","Responsive?":"YES","GC created":"YES","PM":"XUEQI","1st meet":"YES","2D":"PENDING","Quotation":"PENDING","2nd meet":null,"Revised 2D":null,"Revised Quotation":null,"Site visit":null,"Comments":null,"1st Deposit":null,"2nd Deposit":null,"FINAL STATUS":"ACTIVE","stage":"1st Meeting"},{"Date":"01 Feb 2026","Number":64,"Source":"Ad","Phone":90902090,"Type":"BTO","Name":"Joreen","Responsive?":"NO","GC created":null,"PM":null,"1st meet":null,"2D":null,"Quotation":null,"2nd meet":null,"Revised 2D":null,"Revised Quotation":null,"Site visit":null,"Comments":null,"1st Deposit":null,"2nd Deposit":null,"FINAL STATUS":"LAPSED","stage":"New Lead"},{"Date":"01 Feb 2026","Number":65,"Source":"Ad","Phone":98569227,"Type":"BTO","Name":"Zuri (DMZ)","Responsive?":"NO","GC created":"WAITING FOR CUSTOMER ACCEPTANCE","PM":"PENGFEI","1st meet":null,"2D":null,"Quotation":null,"2nd meet":null,"Revised 2D":null,"Revised Quotation":null,"Site visit":null,"Comments":"No longer wants quote","1st Deposit":null,"2nd Deposit":null,"FINAL STATUS":"LAPSED","stage":"New Lead"},{"Date":"31 Jan 2026","Number":66,"Source":"Ad","Phone":81680355,"Type":"EC","Name":"Zhao Hong","Responsive?":"NO","GC created":"YES","PM":"SHAN","1st meet":null,"2D":null,"Quotation":null,"2nd meet":null,"Revised 2D":null,"Revised Quotation":null,"Site visit":null,"Comments":null,"1st Deposit":null,"2nd Deposit":null,"FINAL STATUS":"ACTIVE","stage":"GC Created"},{"Date":"03 Feb 2026","Number":67,"Source":"Ad","Phone":91372718,"Type":"Resale","Name":"Yong","Responsive?":"YES","GC created":"YES","PM":"SHAN","1st meet":"SCHEDULED","2D":null,"Quotation":null,"2nd meet":null,"Revised 2D":null,"Revised Quotation":null,"Site visit":null,"Comments":null,"1st Deposit":null,"2nd Deposit":null,"FINAL STATUS":"ACTIVE","stage":"GC Created"},{"Date":"04 Feb 2026","Number":68,"Source":"Ad","Phone":97538730,"Type":"Resale","Name":"Shannon","Responsive?":"YES","GC created":null,"PM":null,"1st meet":null,"2D":null,"Quotation":null,"2nd meet":null,"Revised 2D":null,"Revised Quotation":null,"Site visit":null,"Comments":"Less than < 5k","1st Deposit":null,"2nd Deposit":null,"FINAL STATUS":"LAPSED","stage":"Responsive"},{"Date":"07 Feb 2026","Number":69,"Source":"Ad","Phone":81894282,"Type":"BTO","Name":"Cheryl","Responsive?":"NO","GC created":null,"PM":null,"1st meet":null,"2D":null,"Quotation":null,"2nd meet":null,"Revised 2D":null,"Revised Quotation":null,"Site visit":null,"Comments":null,"1st Deposit":null,"2nd Deposit":null,"FINAL STATUS":"LAPSED","stage":"New Lead"},{"Date":"07 Feb 2026","Number":70,"Source":"Ad","Phone":91812048,"Type":"BTO","Name":"Amanda","Responsive?":"YES","GC created":null,"PM":null,"1st meet":null,"2D":null,"Quotation":null,"2nd meet":null,"Revised 2D":null,"Revised Quotation":null,"Site visit":null,"Comments":"Key Collection Q4 2026","1st Deposit":null,"2nd Deposit":null,"FINAL STATUS":"LONG KEY COLLECTION","stage":"Responsive"},{"Date":"08 Feb 2026","Number":71,"Source":"Ad","Phone":81012346,"Type":"BTO","Name":"Farah","Responsive?":"YES","GC created":"YES","PM":"XUEQI","1st meet":"SCHEDULED","2D":null,"Quotation":null,"2nd meet":null,"Revised 2D":null,"Revised Quotation":null,"Site visit":null,"Comments":null,"1st Deposit":null,"2nd Deposit":null,"FINAL STATUS":"ACTIVE","stage":"GC Created"},{"Date":"08 Feb 2026","Number":72,"Source":"Ad","Phone":90038355,"Type":"BTO","Name":"Eileen","Responsive?":"NO","GC created":"YES","PM":"XUEQI","1st meet":null,"2D":null,"Quotation":null,"2nd meet":null,"Revised 2D":null,"Revised Quotation":null,"Site visit":null,"Comments":null,"1st Deposit":null,"2nd Deposit":null,"FINAL STATUS":"ACTIVE","stage":"GC Created"},{"Date":"07 Feb 2026","Number":73,"Source":"Ad","Phone":97848194,"Type":"EC","Name":"Lorelle","Responsive?":"NO","GC created":null,"PM":null,"1st meet":null,"2D":null,"Quotation":null,"2nd meet":null,"Revised 2D":null,"Revised Quotation":null,"Site visit":null,"Comments":null,"1st Deposit":null,"2nd Deposit":null,"FINAL STATUS":"LAPSED","stage":"New Lead"},{"Date":"06 Feb 2026","Number":74,"Source":"Ad","Phone":92221652,"Type":"BTO","Name":"Emilia","Responsive?":"NO","GC created":null,"PM":null,"1st meet":null,"2D":null,"Quotation":null,"2nd meet":null,"Revised 2D":null,"Revised Quotation":null,"Site visit":null,"Comments":null,"1st Deposit":null,"2nd Deposit":null,"FINAL STATUS":"LAPSED","stage":"New Lead"},{"Date":"08 Feb 2026","Number":75,"Source":"Ad","Phone":91596389,"Type":null,"Name":"Claudia","Responsive?":"YES","GC created":null,"PM":null,"1st meet":null,"2D":null,"Quotation":null,"2nd meet":null,"Revised 2D":null,"Revised Quotation":null,"Site visit":null,"Comments":"Only asked about coveless light. < 5k","1st Deposit":null,"2nd Deposit":null,"FINAL STATUS":"LAPSED","stage":"Responsive"},{"Date":"08 Feb 2026","Number":76,"Source":"Ad","Phone":81897412,"Type":"BTO","Name":"Benz (Petta)","Responsive?":"YES","GC created":null,"PM":null,"1st meet":null,"2D":null,"Quotation":null,"2nd meet":null,"Revised 2D":null,"Revised Quotation":null,"Site visit":null,"Comments":"Key Collection Q3 2027","1st Deposit":null,"2nd Deposit":null,"FINAL STATUS":"LONG KEY COLLECTION","stage":"Responsive"},{"Date":"09 Feb 2026","Number":77,"Source":"Ad","Phone":90500906,"Type":"BTO","Name":"MHKNNZ (Hasyir)","Responsive?":"YES","GC created":null,"PM":null,"1st meet":null,"2D":null,"Quotation":null,"2nd meet":null,"Revised 2D":null,"Revised Quotation":null,"Site visit":null,"Comments":"Key Collection Q2 2027","1st Deposit":null,"2nd Deposit":null,"FINAL STATUS":"LONG KEY COLLECTION","stage":"Responsive"},{"Date":"07 Feb 2026","Number":78,"Source":"Ad","Phone":90606578,"Type":"BTO","Name":"PK (Ho)","Responsive?":"NO","GC created":null,"PM":null,"1st meet":null,"2D":null,"Quotation":null,"2nd meet":null,"Revised 2D":null,"Revised Quotation":null,"Site visit":null,"Comments":"\"I'll revert if I'm keen\"","1st Deposit":null,"2nd Deposit":null,"FINAL STATUS":"LAPSED","stage":"New Lead"},{"Date":"05 Feb 2026","Number":79,"Source":"Ad","Phone":92343322,"Type":"BTO","Name":"Solihin (Sol)","Responsive?":"YES","GC created":null,"PM":null,"1st meet":null,"2D":null,"Quotation":null,"2nd meet":null,"Revised 2D":null,"Revised Quotation":null,"Site visit":null,"Comments":"Key Collection Q1 2027","1st Deposit":null,"2nd Deposit":null,"FINAL STATUS":"LONG KEY COLLECTION","stage":"Responsive"},{"Date":"09 Feb 2026","Number":80,"Source":"Ad","Phone":97225780,"Type":"BTO","Name":"Mamat","Responsive?":"YES","GC created":"YES","PM":"XUEQI","1st meet":"SCHEDULED","2D":null,"Quotation":null,"2nd meet":null,"Revised 2D":null,"Revised Quotation":null,"Site visit":null,"Comments":null,"1st Deposit":null,"2nd Deposit":null,"FINAL STATUS":"ACTIVE","stage":"GC Created"},{"Date":"09 Feb 2026","Number":81,"Source":"Ad","Phone":82890375,"Type":null,"Name":"Peng Phin","Responsive?":"YES","GC created":null,"PM":null,"1st meet":null,"2D":null,"Quotation":null,"2nd meet":null,"Revised 2D":null,"Revised Quotation":null,"Site visit":null,"Comments":"Only asked about coveless light. < 5k","1st Deposit":null,"2nd Deposit":null,"FINAL STATUS":"LAPSED","stage":"Responsive"},{"Date":"09 Feb 2026","Number":82,"Source":"Ad","Phone":90683398,"Type":"BTO","Name":"Zayd","Responsive?":"YES","GC created":null,"PM":null,"1st meet":null,"2D":null,"Quotation":null,"2nd meet":null,"Revised 2D":null,"Revised Quotation":null,"Site visit":null,"Comments":"Key Collection Q2 2027","1st Deposit":null,"2nd Deposit":null,"FINAL STATUS":"LONG KEY COLLECTION","stage":"Responsive"},{"Date":"10 Feb 2026","Number":83,"Source":"Ad","Phone":83809889,"Type":"Bungalow","Name":"Ms Vicky","Responsive?":"YES","GC created":null,"PM":null,"1st meet":null,"2D":null,"Quotation":null,"2nd meet":null,"Revised 2D":null,"Revised Quotation":null,"Site visit":null,"Comments":"Pending drawn out floorplan","1st Deposit":null,"2nd Deposit":null,"FINAL STATUS":"ACTIVE","stage":"Responsive"},{"Date":"05 Feb 2026","Number":84,"Source":"Ad","Phone":81769626,"Type":"BTO","Name":"Kelly Ying Fen","Responsive?":"NO","GC created":null,"PM":null,"1st meet":null,"2D":null,"Quotation":null,"2nd meet":null,"Revised 2D":null,"Revised Quotation":null,"Site visit":null,"Comments":null,"1st Deposit":null,"2nd Deposit":null,"FINAL STATUS":"LAPSED","stage":"New Lead"},{"Date":"07 Feb 2026","Number":85,"Source":"Ad","Phone":81894282,"Type":"BTO","Name":"Cheryl","Responsive?":"NO","GC created":null,"PM":null,"1st meet":null,"2D":null,"Quotation":null,"2nd meet":null,"Revised 2D":null,"Revised Quotation":null,"Site visit":null,"Comments":null,"1st Deposit":null,"2nd Deposit":null,"FINAL STATUS":"LAPSED","stage":"New Lead"},{"Date":"02 Feb 2026","Number":86,"Source":"Ad","Phone":86862324,"Type":"Condo","Name":"XiuEr","Responsive?":"NO","GC created":null,"PM":null,"1st meet":null,"2D":null,"Quotation":null,"2nd meet":null,"Revised 2D":null,"Revised Quotation":null,"Site visit":null,"Comments":null,"1st Deposit":null,"2nd Deposit":null,"FINAL STATUS":"LAPSED","stage":"New Lead"},{"Date":"06 Feb 2026","Number":87,"Source":"Ad","Phone":90214856,"Type":"BTO","Name":"JFLim (Jenn Feng)","Responsive?":"YES","GC created":"YES","PM":"XUEQI","1st meet":"SCHEDULED","2D":null,"Quotation":null,"2nd meet":null,"Revised 2D":null,"Revised Quotation":null,"Site visit":null,"Comments":null,"1st Deposit":null,"2nd Deposit":null,"FINAL STATUS":"ACTIVE","stage":"GC Created"},{"Date":"09 Feb 2026","Number":88,"Source":"Ad","Phone":90288474,"Type":"Condo","Name":"Nisha","Responsive?":"YES","GC created":"YES","PM":"SHAN","1st meet":"YES","2D":"PENDING","Quotation":"PENDING","2nd meet":null,"Revised 2D":null,"Revised Quotation":null,"Site visit":null,"Comments":null,"1st Deposit":null,"2nd Deposit":null,"FINAL STATUS":"ACTIVE","stage":"1st Meeting"},{"Date":"07 Feb 2026","Number":89,"Source":"Ad","Phone":98746560,"Type":"BTO","Name":"Raj Krish","Responsive?":"YES","GC created":"YES","PM":"XUEQI","1st meet":"YES","2D":"PENDING","Quotation":"PENDING","2nd meet":null,"Revised 2D":null,"Revised Quotation":null,"Site visit":null,"Comments":null,"1st Deposit":null,"2nd Deposit":null,"FINAL STATUS":"ACTIVE","stage":"1st Meeting"},{"Date":"09 Feb 2026","Number":90,"Source":"Ad","Phone":80534066,"Type":"BTO","Name":"Renuga Sarawana","Responsive?":"YES","GC created":"NO","PM":"SHAN","1st meet":null,"2D":"PENDING","Quotation":"PENDING","2nd meet":null,"Revised 2D":null,"Revised Quotation":null,"Site visit":null,"Comments":null,"1st Deposit":null,"2nd Deposit":null,"FINAL STATUS":"ACTIVE","stage":"Responsive"},{"Date":"10 Feb 2026","Number":91,"Source":"Ad","Phone":81335699,"Type":"Resale","Name":"Jimmy Ng","Responsive?":"YES","GC created":null,"PM":null,"1st meet":null,"2D":null,"Quotation":null,"2nd meet":null,"Revised 2D":null,"Revised Quotation":null,"Site visit":null,"Comments":null,"1st Deposit":null,"2nd Deposit":null,"FINAL STATUS":"ACTIVE","stage":"Responsive"},{"Date":"10 Feb 2026","Number":92,"Source":"Ad","Phone":85002588,"Type":"Resale","Name":"Ray","Responsive?":"YES","GC created":"YES","PM":"SHAN","1st meet":"SCHEDULED","2D":null,"Quotation":null,"2nd meet":null,"Revised 2D":null,"Revised Quotation":null,"Site visit":null,"Comments":null,"1st Deposit":null,"2nd Deposit":null,"FINAL STATUS":"ACTIVE","stage":"GC Created"},{"Date":"08 Feb 2026","Number":93,"Source":"Ad","Phone":81610851,"Type":null,"Name":"Mrs Law","Responsive?":"NO","GC created":null,"PM":null,"1st meet":null,"2D":null,"Quotation":null,"2nd meet":null,"Revised 2D":null,"Revised Quotation":null,"Site visit":null,"Comments":null,"1st Deposit":null,"2nd Deposit":null,"FINAL STATUS":"LAPSED","stage":"New Lead"},{"Date":"11 Feb 2026","Number":94,"Source":"Ad","Phone":97453128,"Type":null,"Name":"Cathrine","Responsive?":"YES","GC created":null,"PM":null,"1st meet":null,"2D":null,"Quotation":null,"2nd meet":null,"Revised 2D":null,"Revised Quotation":null,"Site visit":null,"Comments":null,"1st Deposit":null,"2nd Deposit":null,"FINAL STATUS":"ACTIVE","stage":"Responsive"}];

const PIPELINE_STAGES = ['Responsive','GC Created','1st Meeting','2D','Quotation','2nd Meeting','Revised 2D','Revised Quotation','Site Visit','1st Deposit','2nd Deposit'];
const PIPELINE_STEPS  = ['Responsive?','GC created','1st meet','2D','Quotation','2nd meet','Revised 2D','Revised Quotation','Site visit','1st Deposit','2nd Deposit'];
const STAGE_ORDER = {'New Lead':0,'Responsive':1,'GC Created':2,'1st Meeting':3,'2D':4,'Quotation':5,'2nd Meeting':6,'Revised 2D':7,'Revised Quotation':8,'Site Visit':9,'1st Deposit':10,'2nd Deposit':11};

let editMode = false;
let currentPipelineFilter = 'ALL';

function getProgress(stage) { return Math.round(((STAGE_ORDER[stage]||0)/11)*100); }
function esc(s) { if(!s) return ''; return String(s).replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;'); }

function cellVal(v) {
  if(v===null||v===undefined||v==='') return '<span style="color:#CCC">‚Äî</span>';
  const u = String(v).toUpperCase();
  if(u==='YES') return `<span class="cell-yes">‚úì YES</span>`;
  if(u==='NO') return `<span class="cell-no">‚úó NO</span>`;
  if(u==='PENDING') return `<span class="cell-pending">Pending</span>`;
  if(u==='SCHEDULED') return `<span class="cell-scheduled">Scheduled</span>`;
  return esc(v);
}

// Parse key collection quarter from comments string
function parseKeyCollectionQuarter(comments) {
  if(!comments) return null;
  const m = comments.match(/Q([1-4])\s+(\d{4})/i);
  if(!m) return null;
  return { q: parseInt(m[1]), year: parseInt(m[2]) };
}

// Is it now 1 quarter before the given Q/year?
function isReachOutNow(kc) {
  if(!kc) return false;
  const now = new Date();
  const nowQ = Math.floor(now.getMonth() / 3) + 1;
  const nowYear = now.getFullYear();
  // One quarter before
  let targetQ = kc.q - 1;
  let targetYear = kc.year;
  if(targetQ === 0) { targetQ = 4; targetYear -= 1; }
  return nowQ === targetQ && nowYear === targetYear;
}

// ‚îÄ‚îÄ PIPELINE FILTER ‚îÄ‚îÄ
let pipelineFiltered = [...CHYLER_DATA];

function setPipelineFilter(status, el) {
  currentPipelineFilter = status;
  document.querySelectorAll('.status-filter-pill').forEach(p => p.classList.remove('selected'));
  el.classList.add('selected');
  applyPipelineSectionVisibility();
}

function applyPipelineSectionVisibility() {
  const f = currentPipelineFilter;
  const sections = {
    'section-reachout': f === 'ALL' || f === 'REACHOUT',
    'section-active':   f === 'ALL' || f === 'ACTIVE',
    'section-signed':   f === 'ALL' || f === 'SIGNED',
    'section-lapsed':   f === 'ALL' || f === 'LAPSED',
    'section-keyco':    f === 'ALL' || f === 'KEYCO',
  };
  Object.entries(sections).forEach(([id, show]) => {
    const el = document.getElementById(id);
    if(el) el.style.display = show ? '' : 'none';
  });
}

function initPipeline() {
  const pms = [...new Set(CHYLER_DATA.map(r=>r.PM).filter(Boolean))].sort();
  pms.forEach(pm => {
    const o=document.createElement('option'); o.value=pm; o.textContent=pm;
    document.getElementById('pipeline-pm-filter').appendChild(o);
  });
  const types = [...new Set(CHYLER_DATA.map(r=>r.Type).filter(Boolean))].sort();
  types.forEach(t => {
    const o=document.createElement('option'); o.value=t; o.textContent=t;
    document.getElementById('pipeline-type-filter').appendChild(o);
  });
  renderPipeline(CHYLER_DATA);
}

function filterPipeline() {
  const q = document.getElementById('pipeline-search').value.toLowerCase();
  const pm = document.getElementById('pipeline-pm-filter').value;
  const type = document.getElementById('pipeline-type-filter').value;
  renderPipeline(CHYLER_DATA.filter(r => {
    const matchQ = !q || [r.Name, r.Phone+'', r.PM, r.Comments, r.Type].some(v=>v&&v.toLowerCase().includes(q));
    return matchQ && (!pm||r.PM===pm) && (!type||r.Type===type);
  }));
}

function renderPipeline(data) {
  const active=data.filter(r=>r['FINAL STATUS']==='ACTIVE');
  const signed=data.filter(r=>r['FINAL STATUS']==='SIGNED');
  const lapsed=data.filter(r=>r['FINAL STATUS']==='LAPSED');
  const keyco =data.filter(r=>r['FINAL STATUS']==='LONG KEY COLLECTION');

  // Reach out: Long Key Collection customers whose key collection is next quarter
  const reachout = keyco.filter(r => {
    const kc = parseKeyCollectionQuarter(r.Comments);
    return isReachOutNow(kc);
  });

  document.getElementById('pill-count-all').textContent    = data.length;
  document.getElementById('pill-count-active').textContent = active.length;
  document.getElementById('pill-count-signed').textContent = signed.length;
  document.getElementById('pill-count-lapsed').textContent = lapsed.length;
  document.getElementById('pill-count-keyco').textContent  = keyco.length;
  document.getElementById('cnt-active').textContent = active.length;
  document.getElementById('cnt-keyco').textContent  = keyco.length;
  document.getElementById('cnt-signed-pipeline').textContent = signed.length;
  document.getElementById('cnt-lapsed').textContent = lapsed.length;
  document.getElementById('cnt-reachout').textContent = reachout.length;

  const kanban = document.getElementById('kanban-active');
  const stageGroups = {}; PIPELINE_STAGES.forEach(s=>stageGroups[s]=[]); stageGroups['New Lead']=[];
  active.forEach(r=>{ const s=r.stage||'New Lead'; if(!stageGroups[s]) stageGroups[s]=[]; stageGroups[s].push(r); });
  kanban.innerHTML = Object.entries(stageGroups).filter(([,a])=>a.length>0).map(([stage,leads])=>`
    <div class="stage-col">
      <div class="stage-col-header"><span class="stage-num">${leads.length}</span>${stage}</div>
      ${leads.map(r=>activeCard(r)).join('')}
    </div>`).join('');

  document.getElementById('cards-reachout').innerHTML = reachout.map(r=>reachoutCard(r)).join('');
  document.getElementById('cards-keyco').innerHTML = keyco.map(r=>keycoCard(r)).join('');
  document.getElementById('cards-signed-pipeline').innerHTML = signed.map(r=>miniSignedCard(r)).join('');
  document.getElementById('cards-lapsed').innerHTML = lapsed.map(r=>lapsedCard(r)).join('');

  applyPipelineSectionVisibility();
}

function goToProgression(name) {
  // Switch to progression tab
  document.querySelectorAll('.page').forEach(p=>p.classList.remove('active'));
  document.querySelectorAll('.sub-tab').forEach(t=>t.classList.remove('active'));
  document.getElementById('page-progression').classList.add('active');
  document.querySelectorAll('.sub-tab').forEach(t=>{ if(t.textContent.trim()==='Progression') t.classList.add('active'); });
  // Scroll to row
  setTimeout(() => {
    const rows = document.querySelectorAll('#prog-tbody tr');
    for(const row of rows) {
      const nameCell = row.querySelector('td:nth-child(6)');
      if(nameCell && nameCell.textContent.trim() === name) {
        row.style.background = '#FFF8EE';
        row.scrollIntoView({ behavior: 'smooth', block: 'center' });
        setTimeout(() => { row.style.background = ''; }, 2500);
        break;
      }
    }
  }, 80);
}

function activeCard(r) {
  const pct = getProgress(r.stage);
  return `<div class="card active-card" onclick="goToProgression('${esc(r.Name)}')" style="cursor:pointer">
    <div class="card-name">${esc(r.Name)}</div>
    <div class="card-meta">
      ${r.Type?`<span class="tag type-tag">${esc(r.Type)}</span>`:''}
      ${r.PM?`<span class="tag pm-tag">${esc(r.PM)}</span>`:''}
      <span class="tag">${esc(r.stage)}</span>
    </div>
    <div class="card-phone">${r.Phone}</div>
    <div class="progress-bar"><div class="progress-fill" style="width:${pct}%"></div></div>
    ${r.Comments?`<div class="card-comment">${esc(r.Comments)}</div>`:''}
    <div class="card-date">${r.Date}</div>
  </div>`;
}
function reachoutCard(r) {
  const kc = parseKeyCollectionQuarter(r.Comments);
  const kcStr = kc ? `Q${kc.q} ${kc.year}` : '';
  return `<div class="card reachout-card" onclick="goToProgression('${esc(r.Name)}')" style="cursor:pointer">
    <div class="reachout-badge">üîî Reach Out Now</div>
    <div class="card-name">${esc(r.Name)}</div>
    <div class="card-meta">${r.Type?`<span class="tag type-tag">${esc(r.Type)}</span>`:''}</div>
    <div class="card-phone">${r.Phone}</div>
    ${kcStr?`<div class="card-date" style="color:#4A55A2;font-weight:600">Key Collection: ${kcStr}</div>`:''}
    ${r.Comments?`<div class="card-comment">${esc(r.Comments)}</div>`:''}
    <div class="card-date">${r.Date}</div>
  </div>`;
}
function keycoCard(r) {
  const kc = parseKeyCollectionQuarter(r.Comments);
  const kcStr = kc ? `Q${kc.q} ${kc.year}` : '';
  return `<div class="card keyco-card" onclick="goToProgression('${esc(r.Name)}')" style="cursor:pointer">
    <div class="card-name">${esc(r.Name)}</div>
    <div class="card-meta">${r.Type?`<span class="tag type-tag">${esc(r.Type)}</span>`:''}</div>
    <div class="card-phone">${r.Phone}</div>
    ${kcStr?`<div class="card-date" style="font-weight:600;color:var(--keyco)">Key Collection: ${kcStr}</div>`:''}
    ${r.Comments?`<div class="card-comment">${esc(r.Comments)}</div>`:''}
    <div class="card-date">${r.Date}</div>
  </div>`;
}
function miniSignedCard(r) {
  return `<div class="card signed-card" onclick="goToProgression('${esc(r.Name)}')" style="cursor:pointer">
    <div class="card-name">${esc(r.Name)}</div>
    <div class="card-meta">
      ${r.Type?`<span class="tag type-tag">${esc(r.Type)}</span>`:''}
      ${r.PM?`<span class="tag pm-tag">${esc(r.PM)}</span>`:''}
    </div>
    <div class="card-phone">${r.Phone}</div>
    <div class="card-date">${r.Date}</div>
  </div>`;
}
function lapsedCard(r) {
  return `<div class="card lapsed-card" onclick="goToProgression('${esc(r.Name)}')" style="cursor:pointer">
    <div class="card-name">${esc(r.Name)}</div>
    <div class="card-meta">
      ${r.Type?`<span class="tag type-tag">${esc(r.Type)}</span>`:''}
      <span class="tag">${esc(r.stage)}</span>
    </div>
    <div class="card-phone">${r.Phone}</div>
    ${r.Comments?`<div class="card-comment">${esc(r.Comments)}</div>`:''}
    <div class="card-date">${r.Date}</div>
  </div>`;
}

// ‚îÄ‚îÄ PROGRESSION ‚îÄ‚îÄ
let progFiltered = [...CHYLER_DATA];

function initProgression() {
  const pms = [...new Set(CHYLER_DATA.map(r=>r.PM).filter(Boolean))].sort();
  pms.forEach(pm => {
    const o=document.createElement('option'); o.value=pm; o.textContent=pm;
    document.getElementById('prog-pm-filter').appendChild(o);
  });
  renderProgression(CHYLER_DATA);
}

function filterProgression() {
  const q = document.getElementById('prog-search').value.toLowerCase();
  const st = document.getElementById('prog-status-filter').value;
  const pm = document.getElementById('prog-pm-filter').value;
  progFiltered = CHYLER_DATA.filter(r => {
    const matchQ = !q || [r.Name, r.Phone+'', r.PM, r.Comments, r.Type, r['FINAL STATUS']].some(v=>v&&v.toLowerCase().includes(q));
    return matchQ && (!st||r['FINAL STATUS']===st) && (!pm||r.PM===pm);
  });
  renderProgression(progFiltered);
}

function renderProgression(data) {
  const editable = editMode ? 'contenteditable="true"' : '';
  document.getElementById('prog-tbody').innerHTML = data.map(r => {
    const st=r['FINAL STATUS'];
    const stClass=st==='LONG KEY COLLECTION'?'LONG':st;
    const stLabel=st==='LONG KEY COLLECTION'?'Key Collection':st;
    return `<tr>
      <td ${editable} style="color:var(--muted);font-size:0.78rem">${esc(r.Number)}</td>
      <td ${editable} style="color:var(--muted);font-size:0.78rem;white-space:nowrap">${esc(r.Date)}</td>
      <td ${editable} style="font-size:0.78rem">${esc(r.Source)}</td>
      <td ${editable} style="color:var(--muted);font-size:0.78rem">${r.Phone}</td>
      <td ${editable}>${r.Type?`<span class="tag type-tag">${esc(r.Type)}</span>`:'‚Äî'}</td>
      <td ${editable} style="font-weight:600">${esc(r.Name)}</td>
      <td>${st==='ACTIVE' ? `<span class="tag stage-tag">${esc(r.stage||'‚Äî')}</span>` : '<span style="color:#CCC">‚Äî</span>'}</td>
      <td>${cellVal(r['Responsive?'])}</td>
      <td>${cellVal(r['GC created'])}</td>
      <td>${r.PM?`<span class="tag pm-tag">${esc(r.PM)}</span>`:'<span style="color:#CCC">‚Äî</span>'}</td>
      <td>${cellVal(r['1st meet'])}</td>
      <td>${cellVal(r['2D'])}</td>
      <td>${cellVal(r['Quotation'])}</td>
      <td>${cellVal(r['2nd meet'])}</td>
      <td>${cellVal(r['Revised 2D'])}</td>
      <td>${cellVal(r['Revised Quotation'])}</td>
      <td>${cellVal(r['Site visit'])}</td>
      <td ${editable} style="font-size:0.75rem;color:var(--muted);max-width:200px;white-space:normal">${esc(r.Comments)||'<span style="color:#CCC">‚Äî</span>'}</td>
      <td>${cellVal(r['1st Deposit'])}</td>
      <td>${cellVal(r['2nd Deposit'])}</td>
      <td><span class="status-badge ${stClass}">${stLabel}</span></td>
    </tr>`;
  }).join('');
}

// ‚îÄ‚îÄ EDIT MODE ‚îÄ‚îÄ
function toggleEditMode() {
  editMode = !editMode;
  const btn = document.getElementById('edit-toggle-btn');
  const banner = document.getElementById('edit-banner');
  const wrap = document.getElementById('prog-table-wrap');
  if(editMode) {
    btn.classList.add('active');
    btn.innerHTML = `<svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><path d="M11 4H4a2 2 0 00-2 2v14a2 2 0 002 2h14a2 2 0 002-2v-7"/><path d="M18.5 2.5a2.121 2.121 0 013 3L12 15l-4 1 1-4 9.5-9.5z"/></svg> Editing On`;
    banner.classList.add('visible');
    wrap.classList.add('edit-mode');
  } else {
    btn.classList.remove('active');
    btn.innerHTML = `<svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><path d="M11 4H4a2 2 0 00-2 2v14a2 2 0 002 2h14a2 2 0 002-2v-7"/><path d="M18.5 2.5a2.121 2.121 0 013 3L12 15l-4 1 1-4 9.5-9.5z"/></svg> Edit`;
    banner.classList.remove('visible');
    wrap.classList.remove('edit-mode');
  }
  renderProgression(progFiltered.length ? progFiltered : CHYLER_DATA);
}

// ‚îÄ‚îÄ EXCEL DOWNLOAD ‚îÄ‚îÄ
function downloadExcel() {
  const data = progFiltered.length ? progFiltered : CHYLER_DATA;
  const cols = ['Number','Date','Source','Phone','Type','Name','stage','Responsive?','GC created','PM','1st meet','2D','Quotation','2nd meet','Revised 2D','Revised Quotation','Site visit','Comments','1st Deposit','2nd Deposit','FINAL STATUS'];
  const headers = ['A ¬∑ #','B ¬∑ Date','C ¬∑ Source','D ¬∑ Phone','E ¬∑ Type','F ¬∑ Name','Current Status','G ¬∑ Responsive?','H ¬∑ GC Created','I ¬∑ PM','J ¬∑ 1st Meet','K ¬∑ 2D','L ¬∑ Quotation','M ¬∑ 2nd Meet','N ¬∑ Revised 2D','O ¬∑ Revised Quot.','P ¬∑ Site Visit','Q ¬∑ Comments','R ¬∑ 1st Deposit','S ¬∑ 2nd Deposit','T ¬∑ Final Status'];

  // Build CSV with BOM for Excel
  let csv = '\uFEFF' + headers.join(',') + '\n';
  data.forEach(r => {
    const row = cols.map(c => {
      let v = r[c];
      if(v===null||v===undefined) v='';
      v = String(v).replace(/"/g,'""');
      if(v.includes(',') || v.includes('\n') || v.includes('"')) v = `"${v}"`;
      return v;
    });
    csv += row.join(',') + '\n';
  });

  const blob = new Blob([csv], {type: 'text/csv;charset=utf-8;'});
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a');
  a.href = url;
  a.download = 'Chyler_Leads_Progression.csv';
  a.click();
  URL.revokeObjectURL(url);
}

// ‚îÄ‚îÄ MASTER LIST ‚îÄ‚îÄ
const MASTER_DATA = [
  {name:'Rose',phone:'91910069',type:'Current'},
  {name:'Mark',phone:'85991413',type:'BTO'},
  {name:'YQ',phone:'96886932',type:'Condo'},
  {name:'SiMin',phone:'90119256',type:'BTO'},
  {name:'Kasim',phone:'81185205',type:'BTO'},
  {name:'Hana',phone:'92370923',type:'Resale'},
  {name:'WaWa',phone:'87920605',type:'BTO'},
  {name:'Yun Wen',phone:'88625848',type:'BTO'},
  {name:'Aletheia',phone:'96874495',type:'BTO'},
  {name:'Lucas',phone:'87211980',type:'BTO'},
  {name:'Jacky',phone:'87884799',type:'BTO'},
  {name:'MingWei',phone:'93890756',type:'BTO'},
  {name:'Arliana',phone:'91019940',type:'BTO'},
  {name:'Ameera',phone:'87675695',type:'BTO'},
  {name:'Alan Lau',phone:'90886770',type:'BTO'},
  {name:'Mel',phone:'81630703',type:'Resale'},
  {name:'Joanne',phone:'97231378',type:'BTO'},
  {name:'Fun',phone:'81803560',type:'BTO'},
  {name:'Adrian',phone:'97938763',type:'BTO'},
  {name:'Jasmine',phone:'86535024',type:'BTO'},
  {name:'Teesha',phone:'97570544',type:'Resale'},
  {name:'Ily',phone:'97479320',type:'Resale'},
  {name:'Kenneth',phone:'96563892',type:'BTO'},
  {name:'Joy',phone:'96326559',type:'BTO'},
  {name:'Stefie Chia',phone:'91594495',type:'BTO'},
  {name:'Krissy',phone:'98470470',type:'BTO'},
  {name:'Esmie',phone:'87831491',type:'Resale'},
  {name:'Eric',phone:'98566883',type:'BTO'},
  {name:'Shawal',phone:'91849022',type:'BTO'},
  {name:'William',phone:'91099029',type:'BTO'},
  {name:'Construction',phone:'96487166',type:'BTO'},
  {name:'Aaron',phone:'81614001',type:'BTO'},
  {name:'Dominic',phone:'98310669',type:'BTO'},
  {name:'Yana',phone:'91878995',type:'BTO'},
  {name:'LeeKee',phone:'84982194',type:'Resale'},
  {name:'Doreen',phone:'87009331',type:'BTO'},
  {name:'Alson',phone:'83332661',type:''},
  {name:'Chin Yee',phone:'87781660',type:'BTO'},
  {name:'Dareios',phone:'83681815',type:'BTO'},
  {name:'Sky',phone:'90309093',type:'BTO'},
  {name:'Timothea',phone:'91715758',type:'BTO'},
  {name:'Lysha',phone:'83288915',type:'BTO'},
  {name:'FangLing',phone:'92976611',type:'BTO'},
  {name:'Jia Le',phone:'91013901',type:'BTO'},
  {name:'Aibo',phone:'81124522',type:'BTO'},
  {name:'Qing Hao',phone:'96343371',type:'BTO'},
  {name:'Hadi',phone:'87532512',type:'Resale'},
  {name:'Anita',phone:'93380868',type:'BTO'},
  {name:'Chandhi',phone:'84245578',type:'Resale'},
  {name:'Chern Yung',phone:'97689238',type:'BTO'},
  {name:'XY Stella',phone:'84345251',type:'Resale'},
  {name:'MeiYi',phone:'96188672',type:'BTO'},
  {name:'Sharena',phone:'97237771',type:'BTO'},
  {name:'Kelvin',phone:'98796426',type:'BTO'},
  {name:'Naz',phone:'88428099',type:'BTO'},
  {name:'Charmyne',phone:'98527959',type:'BTO'},
  {name:'Javier',phone:'91525865',type:'Resale'},
  {name:'Rani',phone:'96202266',type:'BTO'},
  {name:'Derek',phone:'88698191',type:'BTO'},
  {name:'Stacey',phone:'97563961',type:'BTO'},
  {name:'Joreen',phone:'90902090',type:'BTO'},
  {name:'Zuri (DMZ)',phone:'98569227',type:'BTO'},
  {name:'Zhao Hong',phone:'81680355',type:'EC'},
  {name:'Yong',phone:'91372718',type:'Resale'},
  {name:'Shannon',phone:'97538730',type:'Resale'},
  {name:'Cheryl',phone:'81894282',type:'BTO'},
  {name:'Amanda',phone:'91812048',type:'BTO'},
  {name:'Farah',phone:'81012346',type:'BTO'},
  {name:'Eileen',phone:'90038355',type:'BTO'},
  {name:'Lorelle',phone:'97848194',type:'EC'},
  {name:'Emilia',phone:'92221652',type:'BTO'},
  {name:'Claudia',phone:'91596389',type:''},
  {name:'Benz (Petta)',phone:'81897412',type:'BTO'},
  {name:'MHKNNZ (Hasyir)',phone:'90500906',type:'BTO'},
  {name:'PK (Ho)',phone:'90606578',type:'BTO'},
  {name:'Solihin (Sol)',phone:'92343322',type:'BTO'},
  {name:'Mamat',phone:'97225780',type:'BTO'},
  {name:'Peng Phin',phone:'82890375',type:''},
  {name:'Zayd',phone:'90683398',type:'BTO'},
  {name:'Ms Vicky',phone:'83809889',type:'Bungalow'},
  {name:'Kelly Ying Fen',phone:'81769626',type:'BTO'},
  {name:'Cheryl',phone:'81894282',type:'BTO'},
  {name:'XiuEr',phone:'86862324',type:'Condo'},
  {name:'JFLim (Jenn Feng)',phone:'90214856',type:'BTO'},
  {name:'Nisha',phone:'90288474',type:'Condo'},
  {name:'Raj Krish',phone:'98746560',type:'BTO'},
  {name:'Renuga Sarawana',phone:'80534066',type:'BTO'},
  {name:'Jimmy Ng',phone:'81335699',type:'Resale'},
  {name:'Ray',phone:'85002588',type:'Resale'},
  {name:'Mrs Law',phone:'81610851',type:''},
  {name:'Cathrine',phone:'97453128',type:''},
];

let masterFiltered = [...MASTER_DATA];

function initMaster() {
  const types = [...new Set(MASTER_DATA.map(r=>r.type).filter(Boolean))].sort();
  types.forEach(t => {
    const o=document.createElement('option'); o.value=t; o.textContent=t;
    document.getElementById('master-type-filter').appendChild(o);
  });
  renderMaster(MASTER_DATA);
}

function filterMaster() {
  const q = document.getElementById('master-search').value.toLowerCase();
  const type = document.getElementById('master-type-filter').value;
  masterFiltered = MASTER_DATA.filter(r => {
    const matchQ = !q || [r.name, r.phone, r.type].some(v=>v&&v.toLowerCase().includes(q));
    return matchQ && (!type||r.type===type);
  });
  renderMaster(masterFiltered);
}

function renderMaster(data) {
  document.getElementById('master-tbody').innerHTML = data.map((r,i) => `
    <tr>
      <td style="color:var(--muted);font-size:0.75rem">${i+1}</td>
      <td style="font-weight:600">${esc(r.name)}</td>
      <td style="color:var(--muted);font-size:0.82rem">${r.phone}</td>
      <td>${r.type?`<span class="tag type-tag">${esc(r.type)}</span>`:'<span style="color:#CCC">‚Äî</span>'}</td>
    </tr>`).join('');
}

// ‚îÄ‚îÄ NAV ‚îÄ‚îÄ
function switchSubTab(tab, el) {
  document.querySelectorAll('.page').forEach(p=>p.classList.remove('active'));
  document.querySelectorAll('.sub-tab').forEach(t=>t.classList.remove('active'));
  document.getElementById('page-'+tab).classList.add('active');
  el.classList.add('active');
}

function toggleSection(id, btn) {
  const el = document.getElementById(id);
  if(el.classList.contains('collapsed')) {
    el.style.maxHeight = el.scrollHeight+'px';
    el.classList.remove('collapsed');
    btn.textContent='Hide';
  } else {
    el.style.maxHeight = el.scrollHeight+'px';
    requestAnimationFrame(()=>{ el.classList.add('collapsed'); });
    btn.textContent='Show';
  }
}

// ‚îÄ‚îÄ NEW ROW MODAL ‚îÄ‚îÄ
function openNewRowModal() {
  document.getElementById('new-row-modal').classList.add('open');
  const now = new Date();
  const months=['Jan','Feb','Mar','Apr','May','Jun','Jul','Aug','Sep','Oct','Nov','Dec'];
  document.getElementById('new-date').value = `${now.getDate()} ${months[now.getMonth()]} ${now.getFullYear()}`;
  document.getElementById('new-source').value = 'Ad';
  document.getElementById('new-name').focus();
}
function closeNewRowModal() {
  document.getElementById('new-row-modal').classList.remove('open');
}
function saveNewRow() {
  const name = document.getElementById('new-name').value.trim();
  if(!name) { document.getElementById('new-name').focus(); document.getElementById('new-name').style.borderColor='var(--lapsed)'; return; }
  document.getElementById('new-name').style.borderColor='';
  const maxNum = Math.max(...CHYLER_DATA.map(r=>r.Number||0));
  const newRow = {
    Date: document.getElementById('new-date').value||'',
    Number: maxNum+1,
    Source: document.getElementById('new-source').value||'',
    Phone: document.getElementById('new-phone').value||'',
    Type: document.getElementById('new-type').value||null,
    Name: name,
    'Responsive?': null,'GC created': null, PM: null,
    '1st meet': null,'2D': null,'Quotation': null,
    '2nd meet': null,'Revised 2D': null,'Revised Quotation': null,
    'Site visit': null,
    Comments: document.getElementById('new-comments').value||null,
    '1st Deposit': null,'2nd Deposit': null,
    'FINAL STATUS': document.getElementById('new-status').value,
    stage: document.getElementById('new-stage').value,
  };
  CHYLER_DATA.push(newRow);
  MASTER_DATA.push({ name, phone: document.getElementById('new-phone').value||'', type: document.getElementById('new-type').value||'' });
  closeNewRowModal();
  renderProgression(progFiltered.length ? progFiltered : CHYLER_DATA);
  renderPipeline(CHYLER_DATA);
  renderMaster(masterFiltered);
  // Flash the new row
  setTimeout(()=>{
    const rows = document.querySelectorAll('#prog-tbody tr');
    const last = rows[rows.length-1];
    if(last){ last.style.background='#FFF8EE'; last.scrollIntoView({behavior:'smooth',block:'center'}); setTimeout(()=>{last.style.background='';},2000); }
  },80);
}
// Close modal on overlay click
document.getElementById('new-row-modal').addEventListener('click', function(e){ if(e.target===this) closeNewRowModal(); });

initPipeline();
initProgression();
initMaster();
</script>
</body>
</html>
